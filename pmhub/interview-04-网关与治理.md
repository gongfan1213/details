# 面试话术｜网关与微服务治理（Gateway + Nacos + Sentinel）

## 1. 我做了什么（30s 概述）
- 统一入口网关：路由、鉴权、限流、日志、跨域；配合 Nacos 实现注册发现；用 Sentinel 做网关与服务侧的限流/熔断。

## 2. 技术要点
- 动态路由：基于服务名与路径断言，支持灰度（Header/用户标签）。
- 鉴权：网关认证（Token 与白名单），服务授权（细粒度注解）。
- 保护：限流（IP/用户/URI）、熔断降级、自定义兜底。

## 3. 遇到的问题（难点）
1) 网关双重鉴权带来的性能损耗与一致性。
2) 灰度发布命中策略：如何保证“同一用户”会话粘性与回滚快速。
3) 链路追踪丢失：跨网关/线程池后 TraceId 中断。

## 4. 解决方案与取舍
- 鉴权分层：网关做认证与基础黑白名单；授权下沉后端，避免策略散落；统一错误体。
- 灰度：Header 灰度标记 + Nacos metadata + 路由过滤器；发布回滚以路由权重即时切换。
- Trace：在网关注入 TraceId，透传到后端；线程池包装 MDC，保证日志统一。

## 5. 效果与数据
- 网关转发 TP99 < 15ms；限流规则生效 < 1s；灰度切换即时生效。

## 6. 可扩展
- API 聚合、GraphQL BFF；WebSocket 透传；WAF 规则联动。

## 7. 面试官追问
- 问：如何评估限流阈值？
  - 答：基于历史吞吐与基线压测设定，按接口/调用方拆分；提供灰度演练与熔断演练能力。
