# 项目管理功能

## 1. 功能概述

项目管理是PMHub系统的核心业务模块，提供完整的项目生命周期管理功能。该模块支持项目创建、任务管理、团队协作、进度跟踪、文档管理等核心功能，帮助企业高效管理各类项目。

## 2. 技术架构

### 2.1 模块架构

```
项目管理架构:
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面       │    │   项目管理服务   │    │   工作流服务     │
│                 │    │                 │    │                 │
│ - 项目看板       │    │ - 项目CRUD      │    │ - 流程审批      │
│ - 任务管理       │    │ - 任务管理      │    │ - 状态流转      │
│ - 甘特图         │    │ - 成员管理      │    │ - 通知提醒      │
│ - 统计报表       │    │ - 文件管理      │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │
                                ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   系统服务       │    │   消息队列      │    │   文件存储      │
│                 │    │                 │    │                 │
│ - 用户服务       │    │ - 通知消息      │    │ - 项目文档      │
│ - 部门服务       │    │ - 状态变更      │    │ - 任务附件      │
│ - 权限服务       │    │ - 日志记录      │    │ - 图片资源      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2 技术选型

- **后端框架**: Spring Boot + MyBatis-Plus
- **数据库**: MySQL 8.0
- **缓存**: Redis
- **消息队列**: RocketMQ
- **文件存储**: 本地存储 + OSS
- **前端框架**: Vue 2.6 + Element UI
- **图表库**: ECharts

## 3. 核心功能模块

### 3.1 项目管理

#### 3.1.1 项目创建与维护

**功能描述**: 支持项目的创建、编辑、删除和状态管理。

**核心功能**:
- 项目基本信息管理
- 项目状态流转
- 项目分类管理
- 项目模板管理
- 项目归档管理

**数据模型**:
```sql
-- 项目表
CREATE TABLE project (
    project_id BIGINT PRIMARY KEY,
    project_name VARCHAR(100) NOT NULL COMMENT '项目名称',
    project_code VARCHAR(50) NOT NULL COMMENT '项目编码',
    project_type VARCHAR(20) COMMENT '项目类型',
    project_status VARCHAR(20) DEFAULT 'PLANNING' COMMENT '项目状态',
    project_priority VARCHAR(20) DEFAULT 'MEDIUM' COMMENT '项目优先级',
    project_description TEXT COMMENT '项目描述',
    start_date DATE COMMENT '开始日期',
    end_date DATE COMMENT '结束日期',
    actual_start_date DATE COMMENT '实际开始日期',
    actual_end_date DATE COMMENT '实际结束日期',
    progress DECIMAL(5,2) DEFAULT 0.00 COMMENT '项目进度',
    budget DECIMAL(15,2) COMMENT '项目预算',
    actual_cost DECIMAL(15,2) COMMENT '实际成本',
    project_manager_id BIGINT COMMENT '项目经理ID',
    department_id BIGINT COMMENT '所属部门ID',
    create_by VARCHAR(64),
    create_time DATETIME,
    update_by VARCHAR(64),
    update_time DATETIME,
    del_flag CHAR(1) DEFAULT '0'
);
```

**API接口**:
```java
@RestController
@RequestMapping("/project")
public class ProjectController {
    
    // 创建项目
    @PostMapping("/add")
    public AjaxResult add(@RequestBody Project project);
    
    // 修改项目
    @PostMapping("/edit")
    public AjaxResult edit(@RequestBody Project project);
    
    // 项目列表
    @PostMapping("/list")
    public AjaxResult list(@RequestBody ProjectReqVO projectReqVO);
    
    // 项目详情
    @GetMapping("/{projectId}")
    public AjaxResult getProject(@PathVariable Long projectId);
    
    // 删除项目
    @PostMapping("/remove")
    public AjaxResult remove(@RequestBody Long[] projectIds);
    
    // 项目统计
    @GetMapping("/statistics")
    public AjaxResult statistics();
}
```

#### 3.1.2 项目成员管理

**功能描述**: 管理项目团队成员，包括成员分配、角色设置、权限控制。

**核心功能**:
- 成员添加与移除
- 角色权限分配
- 成员工作量统计
- 团队协作管理

**数据模型**:
```sql
-- 项目成员表
CREATE TABLE project_member (
    id BIGINT PRIMARY KEY,
    project_id BIGINT NOT NULL COMMENT '项目ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    role_type VARCHAR(20) COMMENT '角色类型',
    join_date DATE COMMENT '加入日期',
    leave_date DATE COMMENT '离开日期',
    workload DECIMAL(5,2) DEFAULT 100.00 COMMENT '工作量百分比',
    create_time DATETIME,
    update_time DATETIME
);
```

### 3.2 任务管理

#### 3.2.1 任务创建与分配

**功能描述**: 支持任务的创建、分配、跟踪和管理。

**核心功能**:
- 任务创建与编辑
- 任务分配与转派
- 任务状态管理
- 任务优先级设置
- 任务依赖关系

**数据模型**:
```sql
-- 任务表
CREATE TABLE project_task (
    task_id BIGINT PRIMARY KEY,
    project_id BIGINT NOT NULL COMMENT '项目ID',
    parent_task_id BIGINT COMMENT '父任务ID',
    task_name VARCHAR(200) NOT NULL COMMENT '任务名称',
    task_description TEXT COMMENT '任务描述',
    task_type VARCHAR(20) COMMENT '任务类型',
    task_priority VARCHAR(20) DEFAULT 'MEDIUM' COMMENT '任务优先级',
    task_status VARCHAR(20) DEFAULT 'TODO' COMMENT '任务状态',
    assignee_id BIGINT COMMENT '负责人ID',
    reporter_id BIGINT COMMENT '报告人ID',
    estimated_hours DECIMAL(8,2) COMMENT '预估工时',
    actual_hours DECIMAL(8,2) COMMENT '实际工时',
    start_date DATE COMMENT '开始日期',
    due_date DATE COMMENT '截止日期',
    actual_start_date DATE COMMENT '实际开始日期',
    actual_end_date DATE COMMENT '实际完成日期',
    progress DECIMAL(5,2) DEFAULT 0.00 COMMENT '任务进度',
    create_by VARCHAR(64),
    create_time DATETIME,
    update_by VARCHAR(64),
    update_time DATETIME,
    del_flag CHAR(1) DEFAULT '0'
);
```

**API接口**:
```java
@RestController
@RequestMapping("/project/task")
public class ProjectTaskController {
    
    // 创建任务
    @PostMapping("/add")
    public AjaxResult add(@RequestBody ProjectTask task);
    
    // 修改任务
    @PostMapping("/edit")
    public AjaxResult edit(@RequestBody ProjectTask task);
    
    // 任务列表
    @PostMapping("/list")
    public AjaxResult list(@RequestBody TaskReqVO taskReqVO);
    
    // 任务详情
    @GetMapping("/{taskId}")
    public AjaxResult getTask(@PathVariable Long taskId);
    
    // 更新任务状态
    @PostMapping("/updateStatus")
    public AjaxResult updateStatus(@RequestBody TaskStatusUpdateDTO dto);
    
    // 任务分配
    @PostMapping("/assign")
    public AjaxResult assignTask(@RequestBody TaskAssignDTO dto);
}
```

#### 3.2.2 任务状态管理

**任务状态流转**:
```
TODO → IN_PROGRESS → REVIEW → DONE
  ↓         ↓          ↓       ↓
BLOCKED → IN_PROGRESS → REVIEW → DONE
```

**状态变更逻辑**:
```java
@Service
public class ProjectTaskService {
    
    public void updateTaskStatus(Long taskId, String newStatus) {
        ProjectTask task = getTaskById(taskId);
        String oldStatus = task.getTaskStatus();
        
        // 验证状态流转是否合法
        if (!isValidStatusTransition(oldStatus, newStatus)) {
            throw new BusinessException("非法的状态变更");
        }
        
        // 更新任务状态
        task.setTaskStatus(newStatus);
        task.setUpdateTime(new Date());
        
        // 如果是完成状态，设置完成时间
        if ("DONE".equals(newStatus)) {
            task.setActualEndDate(new Date());
        }
        
        // 保存任务
        updateTask(task);
        
        // 发送状态变更通知
        sendStatusChangeNotification(task, oldStatus, newStatus);
        
        // 更新项目进度
        updateProjectProgress(task.getProjectId());
    }
}
```

### 3.3 项目进度管理

#### 3.3.1 进度跟踪

**功能描述**: 实时跟踪项目进度，支持甘特图展示和进度统计。

**核心功能**:
- 进度实时更新
- 甘特图展示
- 里程碑管理
- 进度偏差分析
- 进度报表生成

**进度计算逻辑**:
```java
@Service
public class ProjectProgressService {
    
    public BigDecimal calculateProjectProgress(Long projectId) {
        List<ProjectTask> tasks = taskService.getTasksByProject(projectId);
        
        if (tasks.isEmpty()) {
            return BigDecimal.ZERO;
        }
        
        BigDecimal totalWeight = BigDecimal.ZERO;
        BigDecimal weightedProgress = BigDecimal.ZERO;
        
        for (ProjectTask task : tasks) {
            BigDecimal weight = getTaskWeight(task);
            totalWeight = totalWeight.add(weight);
            weightedProgress = weightedProgress.add(
                weight.multiply(task.getProgress()).divide(BigDecimal.valueOf(100), 2, RoundingMode.HALF_UP)
            );
        }
        
        if (totalWeight.compareTo(BigDecimal.ZERO) == 0) {
            return BigDecimal.ZERO;
        }
        
        return weightedProgress.divide(totalWeight, 2, RoundingMode.HALF_UP)
            .multiply(BigDecimal.valueOf(100));
    }
    
    private BigDecimal getTaskWeight(ProjectTask task) {
        // 根据任务优先级和类型计算权重
        switch (task.getTaskPriority()) {
            case "HIGH": return BigDecimal.valueOf(3);
            case "MEDIUM": return BigDecimal.valueOf(2);
            case "LOW": return BigDecimal.valueOf(1);
            default: return BigDecimal.valueOf(1);
        }
    }
}
```

#### 3.3.2 里程碑管理

**数据模型**:
```sql
-- 里程碑表
CREATE TABLE project_milestone (
    milestone_id BIGINT PRIMARY KEY,
    project_id BIGINT NOT NULL COMMENT '项目ID',
    milestone_name VARCHAR(200) NOT NULL COMMENT '里程碑名称',
    milestone_description TEXT COMMENT '里程碑描述',
    planned_date DATE COMMENT '计划日期',
    actual_date DATE COMMENT '实际日期',
    milestone_status VARCHAR(20) DEFAULT 'PENDING' COMMENT '里程碑状态',
    create_time DATETIME,
    update_time DATETIME
);
```

### 3.4 项目文件管理

#### 3.4.1 文件上传与管理

**功能描述**: 支持项目相关文件的上传、下载、版本管理和权限控制。

**核心功能**:
- 文件上传下载
- 文件版本管理
- 文件权限控制
- 文件分类管理
- 文件搜索功能

**数据模型**:
```sql
-- 项目文件表
CREATE TABLE project_file (
    file_id BIGINT PRIMARY KEY,
    project_id BIGINT NOT NULL COMMENT '项目ID',
    task_id BIGINT COMMENT '关联任务ID',
    file_name VARCHAR(200) NOT NULL COMMENT '文件名',
    file_path VARCHAR(500) NOT NULL COMMENT '文件路径',
    file_size BIGINT COMMENT '文件大小',
    file_type VARCHAR(50) COMMENT '文件类型',
    file_category VARCHAR(50) COMMENT '文件分类',
    version VARCHAR(20) DEFAULT '1.0' COMMENT '文件版本',
    upload_user_id BIGINT COMMENT '上传用户ID',
    upload_time DATETIME COMMENT '上传时间',
    download_count INT DEFAULT 0 COMMENT '下载次数',
    create_time DATETIME,
    update_time DATETIME
);
```

**API接口**:
```java
@RestController
@RequestMapping("/project/file")
public class ProjectFileController {
    
    // 文件上传
    @PostMapping("/upload")
    public AjaxResult upload(@RequestParam("file") MultipartFile file,
                           @RequestParam("projectId") Long projectId,
                           @RequestParam(value = "taskId", required = false) Long taskId);
    
    // 文件下载
    @GetMapping("/download/{fileId}")
    public void download(@PathVariable Long fileId, HttpServletResponse response);
    
    // 文件列表
    @PostMapping("/list")
    public AjaxResult list(@RequestBody FileQueryDTO queryDTO);
    
    // 删除文件
    @PostMapping("/remove")
    public AjaxResult remove(@RequestBody Long[] fileIds);
}
```

### 3.5 项目日志管理

#### 3.5.1 操作日志

**功能描述**: 记录项目相关的操作日志，支持日志查询和审计。

**数据模型**:
```sql
-- 项目日志表
CREATE TABLE project_log (
    log_id BIGINT PRIMARY KEY,
    project_id BIGINT NOT NULL COMMENT '项目ID',
    task_id BIGINT COMMENT '任务ID',
    user_id BIGINT COMMENT '操作用户ID',
    operation_type VARCHAR(50) COMMENT '操作类型',
    operation_content TEXT COMMENT '操作内容',
    operation_time DATETIME COMMENT '操作时间',
    ip_address VARCHAR(50) COMMENT 'IP地址',
    user_agent VARCHAR(500) COMMENT '用户代理'
);
```

## 4. 前端界面设计

### 4.1 项目看板

**功能特点**:
- 拖拽式任务管理
- 实时状态更新
- 多维度筛选
- 自定义列配置

**Vue组件结构**:
```vue
<template>
  <div class="project-kanban">
    <div class="kanban-header">
      <h2>{{ projectName }} - 项目看板</h2>
      <div class="kanban-filters">
        <el-select v-model="filterAssignee" placeholder="按负责人筛选">
          <el-option v-for="user in users" :key="user.id" :label="user.name" :value="user.id" />
        </el-select>
      </div>
    </div>
    
    <div class="kanban-board">
      <div v-for="status in taskStatuses" :key="status.value" class="kanban-column">
        <div class="column-header">
          <h3>{{ status.label }}</h3>
          <span class="task-count">{{ getTaskCount(status.value) }}</span>
        </div>
        <div class="column-content" @drop="onDrop($event, status.value)" @dragover.prevent>
          <div v-for="task in getTasksByStatus(status.value)" :key="task.taskId" 
               class="task-card" draggable="true" @dragstart="onDragStart($event, task)">
            <div class="task-header">
              <span class="task-name">{{ task.taskName }}</span>
              <el-tag :type="getPriorityType(task.taskPriority)" size="mini">
                {{ task.taskPriority }}
              </el-tag>
            </div>
            <div class="task-content">
              <p>{{ task.taskDescription }}</p>
            </div>
            <div class="task-footer">
              <span class="assignee">{{ task.assigneeName }}</span>
              <span class="due-date">{{ formatDate(task.dueDate) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
```

### 4.2 甘特图

**功能特点**:
- 时间轴展示
- 任务依赖关系
- 进度可视化
- 交互式编辑

**ECharts配置**:
```javascript
const ganttOption = {
  tooltip: {
    trigger: 'axis',
    axisPointer: {
      type: 'shadow'
    }
  },
  grid: {
    left: '3%',
    right: '4%',
    bottom: '3%',
    containLabel: true
  },
  xAxis: {
    type: 'time',
    axisLabel: {
      formatter: '{MM-dd}'
    }
  },
  yAxis: {
    type: 'category',
    data: taskNames
  },
  series: [{
    name: '任务进度',
    type: 'custom',
    renderItem: renderGanttItem,
    encode: {
      x: [1, 2],
      y: 0
    },
    data: ganttData
  }]
};
```

### 4.3 统计报表

**报表类型**:
- 项目进度报表
- 任务完成情况报表
- 成员工作量报表
- 项目成本报表

## 5. 集成功能

### 5.1 工作流集成

**审批流程**:
```java
@Service
public class ProjectWorkflowService {
    
    public void startProjectApproval(Project project) {
        // 创建工作流实例
        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(
            "project_approval",
            project.getProjectId().toString(),
            createProcessVariables(project)
        );
        
        // 更新项目状态
        project.setProjectStatus("PENDING_APPROVAL");
        projectService.updateProject(project);
    }
    
    public void handleProjectApproval(String taskId, String action, String comment) {
        // 处理审批结果
        if ("approve".equals(action)) {
            taskService.complete(taskId);
        } else if ("reject".equals(action)) {
            taskService.complete(taskId, Collections.singletonMap("approved", false));
        }
    }
}
```

### 5.2 消息通知

**通知类型**:
- 任务分配通知
- 状态变更通知
- 截止日期提醒
- 项目进度通知

**消息发送**:
```java
@Service
public class ProjectNotificationService {
    
    public void sendTaskAssignmentNotification(ProjectTask task) {
        NotificationMessage message = NotificationMessage.builder()
            .type("TASK_ASSIGNMENT")
            .title("任务分配通知")
            .content(String.format("您被分配了任务：%s", task.getTaskName()))
            .recipientId(task.getAssigneeId())
            .projectId(task.getProjectId())
            .taskId(task.getTaskId())
            .build();
        
        notificationService.sendMessage(message);
    }
}
```

## 6. 性能优化

### 6.1 数据库优化

**索引设计**:
```sql
-- 项目表索引
CREATE INDEX idx_project_status ON project(project_status);
CREATE INDEX idx_project_manager ON project(project_manager_id);
CREATE INDEX idx_project_department ON project(department_id);

-- 任务表索引
CREATE INDEX idx_task_project ON project_task(project_id);
CREATE INDEX idx_task_status ON project_task(task_status);
CREATE INDEX idx_task_assignee ON project_task(assignee_id);
CREATE INDEX idx_task_due_date ON project_task(due_date);
```

### 6.2 缓存策略

**缓存设计**:
```java
@Service
public class ProjectCacheService {
    
    @Cacheable(value = "project", key = "#projectId")
    public Project getProject(Long projectId) {
        return projectMapper.selectById(projectId);
    }
    
    @Cacheable(value = "project_tasks", key = "#projectId")
    public List<ProjectTask> getProjectTasks(Long projectId) {
        return taskMapper.selectByProjectId(projectId);
    }
    
    @CacheEvict(value = {"project", "project_tasks"}, key = "#projectId")
    public void clearProjectCache(Long projectId) {
        // 清除项目相关缓存
    }
}
```

## 7. 监控与统计

### 7.1 项目统计

**统计指标**:
- 项目总数和状态分布
- 任务完成情况
- 成员工作量统计
- 项目进度趋势

**统计接口**:
```java
@RestController
@RequestMapping("/project/statistics")
public class ProjectStatisticsController {
    
    @GetMapping("/overview")
    public AjaxResult getProjectOverview() {
        ProjectStatisticsVO statistics = new ProjectStatisticsVO();
        
        // 项目总数
        statistics.setTotalProjects(projectService.countProjects());
        
        // 各状态项目数量
        statistics.setProjectStatusCount(projectService.getProjectStatusCount());
        
        // 任务统计
        statistics.setTaskStatistics(taskService.getTaskStatistics());
        
        // 成员工作量
        statistics.setMemberWorkload(memberService.getMemberWorkload());
        
        return AjaxResult.success(statistics);
    }
}
```

### 7.2 实时监控

**监控指标**:
- 项目进度实时更新
- 任务状态变更监控
- 系统性能监控
- 异常情况告警

## 8. 扩展功能

### 8.1 项目模板

**模板功能**:
- 预定义项目结构
- 标准任务模板
- 角色权限模板
- 工作流程模板

### 8.2 项目导入导出

**导入导出**:
- Excel格式导入导出
- 项目数据备份
- 模板数据导入
- 历史数据迁移

## 9. 总结

项目管理功能模块是PMHub系统的核心业务模块，具备以下特点：

1. **功能完整**: 涵盖项目全生命周期管理
2. **操作便捷**: 直观的界面设计和交互体验
3. **协作高效**: 支持团队协作和实时沟通
4. **数据准确**: 实时进度跟踪和状态管理
5. **扩展性强**: 支持自定义配置和功能扩展
6. **集成性好**: 与工作流、消息通知等模块深度集成

该模块为企业提供了完整的项目管理解决方案，帮助企业提升项目管理效率和团队协作能力。
