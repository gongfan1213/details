# PMHub 系统架构与设计

## 1. 项目概述

PMHub 是一套基于 SpringCloud & LLM 的微服务智能项目管理系统，旨在帮助开发者快速掌握微服务/分布式项目的架构设计和开发流程。项目采用前后端分离架构，提供单体和微服务两个版本。

## 2. 技术架构

### 2.1 整体架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端层 (Vue3)   │    │   网关层 (Gateway) │    │   服务层 (Microservices) │
│                 │    │                 │    │                 │
│ - 项目管理界面    │    │ - 路由转发       │    │ - 认证服务       │
│ - 工作流设计器    │    │ - 负载均衡       │    │ - 系统服务       │
│ - 流程管理界面    │    │ - 限流熔断       │    │ - 项目服务       │
│ - 系统管理界面    │    │ - 安全认证       │    │ - 工作流服务     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │
                                ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   基础服务层      │    │   数据存储层      │    │   监控运维层      │
│                 │    │                 │    │                 │
│ - Nacos注册中心   │    │ - MySQL数据库    │    │ - 监控中心       │
│ - Redis缓存      │    │ - Redis缓存      │    │ - 链路追踪       │
│ - RocketMQ消息队列│    │ - 文件存储       │    │ - 日志管理       │
│ - Seata分布式事务 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2 技术选型

#### 后端技术栈
- **基础框架**: Spring Boot 2.7.18
- **微服务框架**: Spring Cloud 2021.0.8
- **服务注册发现**: Nacos
- **网关**: Spring Cloud Gateway
- **负载均衡**: Spring Cloud LoadBalancer
- **熔断限流**: Sentinel
- **分布式事务**: Seata
- **消息队列**: RocketMQ
- **缓存**: Redis
- **数据库**: MySQL 8.0
- **ORM框架**: MyBatis-Plus
- **安全框架**: Spring Security + JWT
- **API文档**: Swagger/Knife4j
- **链路追踪**: SkyWalking

#### 前端技术栈
- **框架**: Vue 2.6.12
- **UI组件库**: Element UI 2.15.10
- **状态管理**: Vuex 3.6.0
- **路由**: Vue Router 3.4.9
- **HTTP客户端**: Axios 0.24.0
- **图表库**: ECharts 4.9.0
- **工作流设计器**: BPMN.js 7.5.0

## 3. 微服务架构设计

### 3.1 服务拆分原则

1. **单一职责原则**: 每个服务只负责一个业务领域
2. **高内聚低耦合**: 服务内部功能紧密相关，服务间依赖最小化
3. **数据自治**: 每个服务管理自己的数据，避免跨服务数据访问
4. **接口稳定**: 服务间通过稳定的API接口通信

### 3.2 服务模块划分

```
pmhub/
├── pmhub-gateway/          # 网关服务 (6880)
├── pmhub-auth/             # 认证服务 (6800)
├── pmhub-api/              # API接口模块
│   ├── pmhub-api-system/   # 系统接口
│   └── pmhub-api-workflow/ # 流程接口
├── pmhub-base/             # 基础组件
│   ├── pmhub-base-core/    # 核心组件
│   ├── pmhub-base-security/# 安全组件
│   ├── pmhub-base-datasource/# 数据源组件
│   ├── pmhub-base-swagger/ # API文档组件
│   ├── pmhub-base-seata/   # 分布式事务组件
│   └── pmhub-base-notice/  # 消息通知组件
├── pmhub-modules/          # 业务模块
│   ├── pmhub-system/       # 系统管理服务 (6801)
│   ├── pmhub-project/      # 项目管理服务 (6806)
│   ├── pmhub-workflow/     # 工作流服务 (6808)
│   ├── pmhub-gen/          # 代码生成服务 (6802)
│   └── pmhub-job/          # 定时任务服务 (6803)
└── pmhub-monitor/          # 监控中心 (6888)
```

### 3.3 服务通信设计

#### 同步通信
- **OpenFeign**: 服务间RESTful API调用
- **负载均衡**: 自动负载均衡和故障转移
- **熔断降级**: Sentinel实现服务保护

#### 异步通信
- **RocketMQ**: 消息队列实现异步通信
- **事件驱动**: 基于消息的事件驱动架构
- **解耦设计**: 服务间松耦合通信

## 4. 数据架构设计

### 4.1 数据库设计原则

1. **分库分表**: 按业务模块分库，按数据量分表
2. **读写分离**: 主从复制，读写分离
3. **数据一致性**: 分布式事务保证数据一致性
4. **缓存策略**: 多级缓存提升性能

### 4.2 数据存储方案

```
数据库设计:
├── pmhub-system/     # 系统管理数据库
├── pmhub-project/    # 项目管理数据库
├── pmhub-workflow/   # 工作流数据库
├── pmhub-gen/        # 代码生成数据库
├── pmhub-job/        # 定时任务数据库
├── pmhub-nacos/      # 配置中心数据库
└── pmhub-seata/      # 分布式事务数据库
```

### 4.3 缓存策略

- **一级缓存**: MyBatis本地缓存
- **二级缓存**: Redis分布式缓存
- **缓存更新**: 基于消息的缓存更新机制
- **缓存穿透**: 布隆过滤器防止缓存穿透

## 5. 安全架构设计

### 5.1 认证授权

- **JWT Token**: 无状态认证
- **OAuth2**: 第三方认证集成
- **RBAC**: 基于角色的访问控制
- **权限粒度**: 菜单权限、按钮权限、数据权限

### 5.2 安全防护

- **XSS防护**: 输入输出过滤
- **SQL注入防护**: 参数化查询
- **CSRF防护**: Token验证
- **接口限流**: 防止恶意攻击

## 6. 高可用设计

### 6.1 服务高可用

- **服务集群**: 多实例部署
- **负载均衡**: 自动负载均衡
- **故障转移**: 自动故障转移
- **健康检查**: 定期健康检查

### 6.2 数据高可用

- **主从复制**: 数据库主从复制
- **数据备份**: 定期数据备份
- **灾难恢复**: 快速灾难恢复
- **监控告警**: 实时监控告警

## 7. 可扩展性设计

### 7.1 水平扩展

- **无状态设计**: 服务无状态化
- **负载均衡**: 支持水平扩展
- **数据分片**: 支持数据分片
- **微服务拆分**: 支持服务拆分

### 7.2 垂直扩展

- **模块化设计**: 支持功能模块扩展
- **插件化架构**: 支持插件扩展
- **配置化**: 支持配置化扩展
- **API版本管理**: 支持API版本管理

## 8. 监控运维

### 8.1 监控体系

- **应用监控**: 应用性能监控
- **业务监控**: 业务指标监控
- **基础设施监控**: 服务器、网络监控
- **日志监控**: 日志收集分析

### 8.2 运维自动化

- **CI/CD**: 持续集成部署
- **容器化**: Docker容器化部署
- **编排管理**: Kubernetes编排管理
- **自动化运维**: 自动化运维脚本

## 9. 部署架构

### 9.1 环境规划

- **开发环境**: 开发调试环境
- **测试环境**: 功能测试环境
- **预生产环境**: 生产前验证环境
- **生产环境**: 正式运行环境

### 9.2 部署方案

- **单体部署**: 适合小规模应用
- **微服务部署**: 适合大规模应用
- **容器化部署**: Docker + Kubernetes
- **云原生部署**: 云平台部署

## 10. 总结

PMHub采用现代化的微服务架构设计，具备以下特点：

1. **技术先进**: 采用主流技术栈，技术成熟稳定
2. **架构清晰**: 模块化设计，职责明确
3. **高可用**: 支持集群部署，具备故障转移能力
4. **可扩展**: 支持水平扩展和垂直扩展
5. **易维护**: 完善的监控运维体系
6. **安全可靠**: 多层次安全防护机制

该架构设计为PMHub提供了坚实的技术基础，支持系统的长期稳定运行和持续演进。
