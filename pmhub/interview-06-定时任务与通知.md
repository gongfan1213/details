# 面试话术｜定时任务与通知（Quartz + RocketMQ）

## 1. 我做了什么（30s 概述）
- 搭建统一的任务编排与通知体系：Quartz 在线维护任务、执行日志、失败重试；RocketMQ 异步通知（任务分配/状态变更/截止提醒）。

## 2. 技术要点
- Quartz 集群与 CRON 表达式；阻塞/并发策略、超时与线程池。
- 通知：主题/Tag 规划，延时消息做 T-1/T-3 天提醒，失败进入 DLQ。

## 3. 遇到的问题（难点）
1) 并发导致重复执行或脏数据。
2) 定时任务与业务事务边界：任务触发时依赖的业务数据一致性。
3) 通知风暴：批量任务变更瞬时产生大量消息。

## 4. 解决方案与取舍
- 并发与幂等：
  - 方案：按业务键加 Redis 分布式锁 + 幂等去重表；任务 handler 接口强制实现幂等。
  - 取舍：极端场景下允许“幂等拒绝”而不重复执行。
- 事务边界：
  - 方案：业务落库成功后投递消息；对强一致场景使用事务消息；失败进入补偿队列。
  - 取舍：关键路径优先一致性，非关键走最终一致。
- 限流与聚合：
  - 方案：消息生产端限速；消费端批处理与合并推送（如同一项目的多条通知汇总）。
  - 取舍：牺牲部分实时性，提升可用性。

## 5. 效果与数据
- 定时任务成功率 > 99.9%；延时消息到达误差 < 2s；通知失败自动补偿成功率 > 99%。

## 6. 可扩展
- 多渠道通知（站内/邮件/企业微信）；日历订阅（ICS）。

## 7. 面试官追问
- 问：如何避免 Quartz 误触发？
  - 答：统一时区；misfire 策略按任务选择（立即执行/错过不补/按一次补偿）；集群 check-in 校准。
