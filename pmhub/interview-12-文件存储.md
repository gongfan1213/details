# 面试话术｜文件存储（上传/下载/权限/版本）

## 1. 我做了什么（30s 概述）
- 统一文件存储方案：支持本地与云存储；实现上传、下载、预览、版本、权限校验；与项目/任务/流程表单打通。

## 2. 技术要点
- 元数据表关联 projectId/taskId；下载统一后端流式输出，防越权；大文件分片（可选）。

## 3. 遇到的问题（难点）
1) 直链越权与防盗链；
2) 大文件上传超时与断点续传；
3) 浏览器预览兼容性。

## 4. 解决方案与取舍
- 安全：
  - 方案：仅后端流式下载；必要时签名 URL + 短期有效；类型白名单与病毒扫描（可选）。
- 可靠：
  - 方案：分片 + 合并，MD5 秒传；上传超时分段重试。
- 预览：
  - 方案：统一 Content-Type；图片/Office 转 PDF 预览（可选）。

## 5. 效果
- 越权访问 0 事故；大文件成功率显著提升。

## 6. 面试官追问
- 问：如何做历史版本与回滚？
  - 答：文件表记录版本号与父子关系；下载默认最新，支持选择历史版本。
