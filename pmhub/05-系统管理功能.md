# 系统管理功能

## 1. 功能概述

系统管理是PMHub系统的基础管理模块，提供系统配置、用户管理、权限控制、日志管理、监控统计等核心功能。该模块基于若依框架构建，为整个系统提供基础的管理和服务支撑。

## 2. 技术架构

### 2.1 模块架构

```
系统管理架构:
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面       │    │   系统管理服务   │    │   基础组件      │
│                 │    │                 │    │                 │
│ - 用户管理       │    │ - 用户服务      │    │ - 权限控制      │
│ - 角色管理       │    │ - 角色服务      │    │ - 数据权限      │
│ - 菜单管理       │    │ - 菜单服务      │    │ - 缓存管理      │
│ - 部门管理       │    │ - 部门服务      │    │ - 日志记录      │
│ - 字典管理       │    │ - 字典服务      │    │ - 文件管理      │
│ - 参数管理       │    │ - 参数服务      │    │ - 通知服务      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2 技术选型

- **后端框架**: Spring Boot + MyBatis-Plus
- **数据库**: MySQL 8.0
- **缓存**: Redis
- **前端框架**: Vue 2.6 + Element UI
- **安全框架**: Spring Security + JWT
- **文件存储**: 本地存储 + OSS

## 3. 核心功能模块

### 3.1 用户管理

#### 3.1.1 用户信息管理

**功能描述**: 管理系统用户的基本信息，包括用户创建、修改、删除、查询等操作。

**核心功能**:
- 用户注册与创建
- 用户信息维护
- 用户状态管理
- 用户导入导出
- 用户密码管理
- 用户头像管理

**数据模型**:
```sql
-- 用户表
CREATE TABLE sys_user (
    user_id BIGINT PRIMARY KEY,
    dept_id BIGINT COMMENT '部门ID',
    user_name VARCHAR(30) NOT NULL COMMENT '用户账号',
    nick_name VARCHAR(30) NOT NULL COMMENT '用户昵称',
    user_type VARCHAR(2) DEFAULT '00' COMMENT '用户类型（00系统用户 01注册用户）',
    email VARCHAR(50) DEFAULT '' COMMENT '用户邮箱',
    phonenumber VARCHAR(11) DEFAULT '' COMMENT '手机号码',
    sex CHAR(1) DEFAULT '0' COMMENT '用户性别（0男 1女 2未知）',
    avatar VARCHAR(100) DEFAULT '' COMMENT '头像路径',
    password VARCHAR(50) DEFAULT '' COMMENT '密码',
    status CHAR(1) DEFAULT '0' COMMENT '帐号状态（0正常 1停用）',
    del_flag CHAR(1) DEFAULT '0' COMMENT '删除标志（0代表存在 2代表删除）',
    login_ip VARCHAR(128) DEFAULT '' COMMENT '最后登录IP',
    login_date DATETIME COMMENT '最后登录时间',
    create_by VARCHAR(64) DEFAULT '' COMMENT '创建者',
    create_time DATETIME COMMENT '创建时间',
    update_by VARCHAR(64) DEFAULT '' COMMENT '更新者',
    update_time DATETIME COMMENT '更新时间',
    remark VARCHAR(500) DEFAULT NULL COMMENT '备注'
);
```

### 3.2 角色管理

#### 3.2.1 角色信息管理

**功能描述**: 管理系统角色，包括角色的创建、修改、删除和权限分配。

**核心功能**:
- 角色创建与维护
- 角色权限分配
- 角色数据权限
- 角色状态管理
- 角色用户关联

**数据模型**:
```sql
-- 角色表
CREATE TABLE sys_role (
    role_id BIGINT PRIMARY KEY,
    role_name VARCHAR(30) NOT NULL COMMENT '角色名称',
    role_key VARCHAR(100) NOT NULL COMMENT '角色权限字符串',
    role_sort INT NOT NULL COMMENT '显示顺序',
    data_scope CHAR(1) DEFAULT '1' COMMENT '数据范围（1：全部数据权限 2：自定数据权限 3：本部门数据权限 4：本部门及以下数据权限）',
    menu_check_strictly TINYINT(1) DEFAULT 1 COMMENT '菜单树选择项是否关联显示',
    dept_check_strictly TINYINT(1) DEFAULT 1 COMMENT '部门树选择项是否关联显示',
    status CHAR(1) NOT NULL COMMENT '角色状态（0正常 1停用）',
    del_flag CHAR(1) DEFAULT '0' COMMENT '删除标志（0代表存在 2代表删除）',
    create_by VARCHAR(64) DEFAULT '' COMMENT '创建者',
    create_time DATETIME COMMENT '创建时间',
    update_by VARCHAR(64) DEFAULT '' COMMENT '更新者',
    update_time DATETIME COMMENT '更新时间',
    remark VARCHAR(500) DEFAULT NULL COMMENT '备注'
);

-- 用户角色关联表
CREATE TABLE sys_user_role (
    user_id BIGINT NOT NULL COMMENT '用户ID',
    role_id BIGINT NOT NULL COMMENT '角色ID',
    PRIMARY KEY (user_id, role_id)
);
```

### 3.3 菜单管理

#### 3.3.1 菜单权限管理

**功能描述**: 管理系统菜单和权限，支持多级菜单和按钮权限控制。

**权限类型**:
- **菜单权限**: 控制用户可访问的菜单
- **按钮权限**: 控制用户可操作的按钮
- **数据权限**: 控制用户可访问的数据范围

**数据模型**:
```sql
-- 菜单表
CREATE TABLE sys_menu (
    menu_id BIGINT PRIMARY KEY,
    menu_name VARCHAR(50) NOT NULL COMMENT '菜单名称',
    parent_id BIGINT DEFAULT 0 COMMENT '父菜单ID',
    order_num INT DEFAULT 0 COMMENT '显示顺序',
    path VARCHAR(200) DEFAULT '' COMMENT '路由地址',
    component VARCHAR(255) DEFAULT NULL COMMENT '组件路径',
    query VARCHAR(255) DEFAULT NULL COMMENT '路由参数',
    is_frame INT DEFAULT 1 COMMENT '是否为外链（0是 1否）',
    is_cache INT DEFAULT 0 COMMENT '是否缓存（0缓存 1不缓存）',
    menu_type CHAR(1) DEFAULT '' COMMENT '菜单类型（M目录 C菜单 F按钮）',
    visible CHAR(1) DEFAULT '0' COMMENT '菜单状态（0显示 1隐藏）',
    status CHAR(1) DEFAULT '0' COMMENT '菜单状态（0正常 1停用）',
    perms VARCHAR(100) DEFAULT NULL COMMENT '权限标识',
    icon VARCHAR(100) DEFAULT '#' COMMENT '菜单图标',
    create_by VARCHAR(64) DEFAULT '' COMMENT '创建者',
    create_time DATETIME COMMENT '创建时间',
    update_by VARCHAR(64) DEFAULT '' COMMENT '更新者',
    update_time DATETIME COMMENT '更新时间',
    remark VARCHAR(500) DEFAULT '' COMMENT '备注'
);

-- 角色菜单关联表
CREATE TABLE sys_role_menu (
    role_id BIGINT NOT NULL COMMENT '角色ID',
    menu_id BIGINT NOT NULL COMMENT '菜单ID',
    PRIMARY KEY (role_id, menu_id)
);
```

### 3.4 部门管理

#### 3.4.1 组织架构管理

**功能描述**: 管理公司的组织架构，支持树形结构的数据权限控制。

**核心功能**:
- 部门树形管理
- 部门信息维护
- 数据权限控制
- 部门状态管理
- 部门人员管理

**数据模型**:
```sql
-- 部门表
CREATE TABLE sys_dept (
    dept_id BIGINT PRIMARY KEY,
    parent_id BIGINT DEFAULT 0 COMMENT '父部门id',
    ancestors VARCHAR(50) DEFAULT '' COMMENT '祖级列表',
    dept_name VARCHAR(30) DEFAULT '' COMMENT '部门名称',
    order_num INT DEFAULT 0 COMMENT '显示顺序',
    leader VARCHAR(20) DEFAULT NULL COMMENT '负责人',
    phone VARCHAR(11) DEFAULT NULL COMMENT '联系电话',
    email VARCHAR(50) DEFAULT NULL COMMENT '邮箱',
    status CHAR(1) DEFAULT '0' COMMENT '部门状态（0正常 1停用）',
    del_flag CHAR(1) DEFAULT '0' COMMENT '删除标志（0代表存在 2代表删除）',
    create_by VARCHAR(64) DEFAULT '' COMMENT '创建者',
    create_time DATETIME COMMENT '创建时间',
    update_by VARCHAR(64) DEFAULT '' COMMENT '更新者',
    update_time DATETIME COMMENT '更新时间'
);
```

### 3.5 字典管理

#### 3.5.1 数据字典管理

**功能描述**: 管理系统中的各种数据字典，提供统一的字典数据管理。

**核心功能**:
- 字典类型管理
- 字典数据管理
- 字典缓存管理
- 字典导入导出

**数据模型**:
```sql
-- 字典类型表
CREATE TABLE sys_dict_type (
    dict_id BIGINT PRIMARY KEY,
    dict_name VARCHAR(100) DEFAULT '' COMMENT '字典名称',
    dict_type VARCHAR(100) DEFAULT '' COMMENT '字典类型',
    status CHAR(1) DEFAULT '0' COMMENT '状态（0正常 1停用）',
    create_by VARCHAR(64) DEFAULT '' COMMENT '创建者',
    create_time DATETIME COMMENT '创建时间',
    update_by VARCHAR(64) DEFAULT '' COMMENT '更新者',
    update_time DATETIME COMMENT '更新时间',
    remark VARCHAR(500) DEFAULT NULL COMMENT '备注'
);

-- 字典数据表
CREATE TABLE sys_dict_data (
    dict_code BIGINT PRIMARY KEY,
    dict_sort INT DEFAULT 0 COMMENT '字典排序',
    dict_label VARCHAR(100) DEFAULT '' COMMENT '字典标签',
    dict_value VARCHAR(100) DEFAULT '' COMMENT '字典键值',
    dict_type VARCHAR(100) DEFAULT '' COMMENT '字典类型',
    css_class VARCHAR(100) DEFAULT NULL COMMENT '样式属性（其他样式扩展）',
    list_class VARCHAR(100) DEFAULT NULL COMMENT '表格回显样式',
    is_default CHAR(1) DEFAULT 'N' COMMENT '是否默认（Y是 N否）',
    status CHAR(1) DEFAULT '0' COMMENT '状态（0正常 1停用）',
    create_by VARCHAR(64) DEFAULT '' COMMENT '创建者',
    create_time DATETIME COMMENT '创建时间',
    update_by VARCHAR(64) DEFAULT '' COMMENT '更新者',
    update_time DATETIME COMMENT '更新时间',
    remark VARCHAR(500) DEFAULT NULL COMMENT '备注'
);
```

### 3.6 参数管理

#### 3.6.1 系统参数管理

**功能描述**: 管理系统配置参数，支持动态配置和参数缓存。

**核心功能**:
- 参数配置管理
- 参数缓存管理
- 参数验证
- 参数导入导出

**数据模型**:
```sql
-- 参数配置表
CREATE TABLE sys_config (
    config_id INT PRIMARY KEY,
    config_name VARCHAR(100) DEFAULT '' COMMENT '参数名称',
    config_key VARCHAR(100) DEFAULT '' COMMENT '参数键名',
    config_value VARCHAR(500) DEFAULT '' COMMENT '参数键值',
    config_type CHAR(1) DEFAULT 'N' COMMENT '系统内置（Y是 N否）',
    create_by VARCHAR(64) DEFAULT '' COMMENT '创建者',
    create_time DATETIME COMMENT '创建时间',
    update_by VARCHAR(64) DEFAULT '' COMMENT '更新者',
    update_time DATETIME COMMENT '更新时间',
    remark VARCHAR(500) DEFAULT NULL COMMENT '备注'
);
```

### 3.7 日志管理

#### 3.7.1 操作日志管理

**功能描述**: 记录系统操作日志，支持日志查询和审计。

**核心功能**:
- 操作日志记录
- 登录日志记录
- 日志查询统计
- 日志清理

**数据模型**:
```sql
-- 操作日志记录
CREATE TABLE sys_oper_log (
    oper_id BIGINT PRIMARY KEY,
    title VARCHAR(50) DEFAULT '' COMMENT '模块标题',
    business_type INT DEFAULT 0 COMMENT '业务类型（0其它 1新增 2修改 3删除）',
    method VARCHAR(100) DEFAULT '' COMMENT '方法名称',
    request_method VARCHAR(10) DEFAULT '' COMMENT '请求方式',
    operator_type INT DEFAULT 0 COMMENT '操作类别（0其它 1后台用户 2手机端用户）',
    oper_name VARCHAR(50) DEFAULT '' COMMENT '操作人员',
    dept_name VARCHAR(50) DEFAULT '' COMMENT '部门名称',
    oper_url VARCHAR(255) DEFAULT '' COMMENT '请求URL',
    oper_ip VARCHAR(128) DEFAULT '' COMMENT '主机地址',
    oper_location VARCHAR(255) DEFAULT '' COMMENT '操作地点',
    oper_param VARCHAR(2000) DEFAULT '' COMMENT '请求参数',
    json_result VARCHAR(2000) DEFAULT '' COMMENT '返回参数',
    status INT DEFAULT 0 COMMENT '操作状态（0正常 1异常）',
    error_msg VARCHAR(2000) DEFAULT '' COMMENT '错误消息',
    oper_time DATETIME COMMENT '操作时间'
);

-- 系统访问记录
CREATE TABLE sys_logininfor (
    info_id BIGINT PRIMARY KEY,
    user_name VARCHAR(50) DEFAULT '' COMMENT '用户账号',
    ipaddr VARCHAR(128) DEFAULT '' COMMENT '登录IP地址',
    login_location VARCHAR(255) DEFAULT '' COMMENT '登录地点',
    browser VARCHAR(50) DEFAULT '' COMMENT '浏览器类型',
    os VARCHAR(50) DEFAULT '' COMMENT '操作系统',
    status CHAR(1) DEFAULT '0' COMMENT '登录状态（0成功 1失败）',
    msg VARCHAR(255) DEFAULT '' COMMENT '提示消息',
    login_time DATETIME COMMENT '访问时间'
);
```

## 4. 前端界面设计

### 4.1 用户管理界面

**用户列表**:
```vue
<template>
  <div class="app-container">
    <el-form :model="queryParams" ref="queryForm" size="small" :inline="true" v-show="showSearch" label-width="68px">
      <el-form-item label="用户名称" prop="userName">
        <el-input
          v-model="queryParams.userName"
          placeholder="请输入用户名称"
          clearable
          @keyup.enter.native="handleQuery"
        />
      </el-form-item>
      <el-form-item label="手机号码" prop="phonenumber">
        <el-input
          v-model="queryParams.phonenumber"
          placeholder="请输入手机号码"
          clearable
          @keyup.enter.native="handleQuery"
        />
      </el-form-item>
      <el-form-item label="状态" prop="status">
        <el-select v-model="queryParams.status" placeholder="用户状态" clearable>
          <el-option
            v-for="dict in dict.type.sys_normal_disable"
            :key="dict.value"
            :label="dict.label"
            :value="dict.value"
          />
        </el-select>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" icon="el-icon-search" size="mini" @click="handleQuery">搜索</el-button>
        <el-button icon="el-icon-refresh" size="mini" @click="resetQuery">重置</el-button>
      </el-form-item>
    </el-form>

    <el-row :gutter="10" class="mb8">
      <el-col :span="1.5">
        <el-button
          type="primary"
          plain
          icon="el-icon-plus"
          size="mini"
          @click="handleAdd"
          v-hasPermi="['system:user:add']"
        >新增</el-button>
      </el-col>
      <el-col :span="1.5">
        <el-button
          type="success"
          plain
          icon="el-icon-edit"
          size="mini"
          :disabled="single"
          @click="handleUpdate"
          v-hasPermi="['system:user:edit']"
        >修改</el-button>
      </el-col>
      <el-col :span="1.5">
        <el-button
          type="danger"
          plain
          icon="el-icon-delete"
          size="mini"
          :disabled="multiple"
          @click="handleDelete"
          v-hasPermi="['system:user:remove']"
        >删除</el-button>
      </el-col>
    </el-row>

    <el-table v-loading="loading" :data="userList" @selection-change="handleSelectionChange">
      <el-table-column type="selection" width="50" align="center" />
      <el-table-column label="用户编号" align="center" prop="userId" />
      <el-table-column label="用户名称" align="center" prop="userName" :show-overflow-tooltip="true" />
      <el-table-column label="用户昵称" align="center" prop="nickName" :show-overflow-tooltip="true" />
      <el-table-column label="部门" align="center" prop="deptName" />
      <el-table-column label="手机号码" align="center" prop="phonenumber" :show-overflow-tooltip="true" />
      <el-table-column label="状态" align="center" prop="status">
        <template slot-scope="scope">
          <dict-tag :options="dict.type.sys_normal_disable" :value="scope.row.status"/>
        </template>
      </el-table-column>
      <el-table-column label="创建时间" align="center" prop="createTime" width="180">
        <template slot-scope="scope">
          <span>{{ parseTime(scope.row.createTime) }}</span>
        </template>
      </el-table-column>
      <el-table-column label="操作" align="center" class-name="small-padding fixed-width">
        <template slot-scope="scope">
          <el-button
            size="mini"
            type="text"
            icon="el-icon-edit"
            @click="handleUpdate(scope.row)"
            v-hasPermi="['system:user:edit']"
          >修改</el-button>
          <el-button
            size="mini"
            type="text"
            icon="el-icon-key"
            @click="handleResetPwd(scope.row)"
            v-hasPermi="['system:user:resetPwd']"
          >重置</el-button>
          <el-button
            size="mini"
            type="text"
            icon="el-icon-delete"
            @click="handleDelete(scope.row)"
            v-hasPermi="['system:user:remove']"
          >删除</el-button>
        </template>
      </el-table-column>
    </el-table>
    
    <pagination
      v-show="total>0"
      :total="total"
      :page.sync="queryParams.pageNum"
      :limit.sync="queryParams.pageSize"
      @pagination="getList"
    />
  </div>
</template>
```

## 5. 集成功能

### 5.1 权限控制集成

**权限验证**:
```java
@Component
public class PermissionService {
    
    public boolean hasPermi(String permission) {
        if (StringUtils.isEmpty(permission)) {
            return false;
        }
        LoginUser loginUser = SecurityUtils.getLoginUser();
        if (StringUtils.isNull(loginUser) || CollectionUtils.isEmpty(loginUser.getPermissions())) {
            return false;
        }
        return hasPermissions(loginUser.getPermissions(), permission);
    }
    
    public boolean hasRole(String role) {
        if (StringUtils.isEmpty(role)) {
            return false;
        }
        LoginUser loginUser = SecurityUtils.getLoginUser();
        if (StringUtils.isNull(loginUser) || CollectionUtils.isEmpty(loginUser.getUser().getRoles())) {
            return false;
        }
        for (SysRole sysRole : loginUser.getUser().getRoles()) {
            String roleKey = sysRole.getRoleKey();
            if (SUPER_ADMIN.equals(roleKey) || role.equals(roleKey)) {
                return true;
            }
        }
        return false;
    }
}
```

### 5.2 数据权限集成

**数据权限控制**:
```java
@Aspect
@Component
public class DataScopeAspect {
    
    @Around("@annotation(controllerDataScope)")
    public Object doConcurrent(ProceedingJoinPoint point, DataScope controllerDataScope) throws Throwable {
        clearDataScope(point);
        handleDataScope(point, controllerDataScope);
        return point.proceed();
    }
    
    protected void handleDataScope(final JoinPoint point, DataScope controllerDataScope) {
        // 获取当前的用户
        LoginUser loginUser = SecurityUtils.getLoginUser();
        if (StringUtils.isNotNull(loginUser)) {
            SysUser currentUser = loginUser.getUser();
            // 如果是超级管理员，则不过滤数据
            if (StringUtils.isNotNull(currentUser) && !currentUser.isAdmin()) {
                dataScopeFilter(joinPoint, currentUser, controllerDataScope.deptAlias(),
                    controllerDataScope.userAlias());
            }
        }
    }
}
```

## 6. 性能优化

### 6.1 缓存优化

**用户信息缓存**:
```java
@Service
public class SysUserService {
    
    @Cacheable(value = "user", key = "#userId")
    public SysUser selectUserById(Long userId) {
        return userMapper.selectUserById(userId);
    }
    
    @CacheEvict(value = "user", key = "#user.userId")
    public int updateUserProfile(SysUser user) {
        return userMapper.updateUser(user);
    }
}
```

### 6.2 数据库优化

**索引设计**:
```sql
-- 用户表索引
CREATE INDEX idx_user_username ON sys_user(user_name);
CREATE INDEX idx_user_phonenumber ON sys_user(phonenumber);
CREATE INDEX idx_user_email ON sys_user(email);
CREATE INDEX idx_user_dept_id ON sys_user(dept_id);

-- 角色表索引
CREATE INDEX idx_role_role_key ON sys_role(role_key);
CREATE INDEX idx_role_status ON sys_role(status);

-- 菜单表索引
CREATE INDEX idx_menu_parent_id ON sys_menu(parent_id);
CREATE INDEX idx_menu_order_num ON sys_menu(order_num);
CREATE INDEX idx_menu_perms ON sys_menu(perms);
```

## 7. 监控与统计

### 7.1 系统监控

**监控指标**:
- 用户在线数量
- 系统访问统计
- 操作日志统计
- 系统性能监控

**监控服务**:
```java
@Service
public class SysMonitorService {
    
    public Map<String, Object> getSystemInfo() {
        Map<String, Object> sysInfo = new HashMap<>();
        
        // 系统信息
        sysInfo.put("sys", SystemUtil.getSystemInfo());
        
        // CPU信息
        sysInfo.put("cpu", SystemUtil.getCpuInfo());
        
        // 内存信息
        sysInfo.put("mem", SystemUtil.getMemInfo());
        
        // JVM信息
        sysInfo.put("jvm", SystemUtil.getJvmInfo());
        
        // 服务器信息
        sysInfo.put("sysFiles", SystemUtil.getSysFiles());
        
        return sysInfo;
    }
    
    public List<SysUserOnline> selectUserOnlineList(SysUserOnline userOnline) {
        return userOnlineMapper.selectUserOnlineList(userOnline);
    }
}
```

### 7.2 统计报表

**统计功能**:
- 用户注册统计
- 登录统计
- 操作统计
- 系统使用统计

## 8. 总结

系统管理功能模块是PMHub系统的基础管理模块，具备以下特点：

1. **功能完整**: 涵盖用户、角色、权限、部门、字典、参数等完整管理功能
2. **权限精细**: 支持菜单权限、按钮权限、数据权限等多维度权限控制
3. **操作便捷**: 提供直观的管理界面和便捷的操作方式
4. **安全可靠**: 完善的权限验证和安全防护机制
5. **性能优化**: 通过缓存和索引优化提升系统性能
6. **监控完善**: 提供完整的系统监控和统计分析功能

该模块为PMHub系统提供了坚实的管理基础，确保系统的安全性和可控性。
