# JoyAgent-JDGenie è¯¦ç»†æŠ€æœ¯æ–‡æ¡£

## ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æ•´ä½“æ¶æ„è®¾è®¡](#2-æ•´ä½“æ¶æ„è®¾è®¡)
3. [Javaåç«¯æœåŠ¡è¯¦è§£](#3-javaåç«¯æœåŠ¡è¯¦è§£)
4. [Pythonå·¥å…·æœåŠ¡è¯¦è§£](#4-pythonå·¥å…·æœåŠ¡è¯¦è§£)
5. [å‰ç«¯Reactåº”ç”¨è¯¦è§£](#5-å‰ç«¯reactåº”ç”¨è¯¦è§£)
6. [æŠ€æœ¯é€‰å‹ä¸è®¾è®¡ç†å¿µ](#6-æŠ€æœ¯é€‰å‹ä¸è®¾è®¡ç†å¿µ)
7. [éƒ¨ç½²ä¸è¿ç»´æŒ‡å—](#7-éƒ¨ç½²ä¸è¿ç»´æŒ‡å—)
8. [å¼€å‘ä¸æ‰©å±•æŒ‡å—](#8-å¼€å‘ä¸æ‰©å±•æŒ‡å—)
9. [APIæ¥å£æ–‡æ¡£](#9-apiæ¥å£æ–‡æ¡£)
10. [å¸¸è§é—®é¢˜ä¸æ•…éšœæ’æŸ¥](#10-å¸¸è§é—®é¢˜ä¸æ•…éšœæ’æŸ¥)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

JoyAgent-JDGenie æ˜¯ä¸šç•Œé¦–ä¸ªå¼€æºçš„é«˜å®Œæˆåº¦è½»é‡åŒ–é€šç”¨å¤šæ™ºèƒ½ä½“äº§å“ï¼Œæ—¨åœ¨è§£å†³å¿«é€Ÿæ„å»ºå¤šæ™ºèƒ½ä½“äº§å“çš„æœ€åä¸€å…¬é‡Œé—®é¢˜ã€‚ä¸å…¶ä»–ä»…æä¾›SDKæˆ–æ¡†æ¶çš„å¼€æºé¡¹ç›®ä¸åŒï¼ŒJoyAgent-JDGenieæ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„å®Œæ•´äº§å“ï¼Œå¯ä»¥ç›´æ¥å¼€ç®±å³ç”¨ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- ğŸš€ **å¼€ç®±å³ç”¨**ï¼šæ— éœ€é¢å¤–å¼€å‘ï¼Œç›´æ¥éƒ¨ç½²ä½¿ç”¨
- ğŸ§  **å¤šæ™ºèƒ½ä½“æ¶æ„**ï¼šæ”¯æŒReActã€Planning & Executorç­‰å¤šç§Agentæ¨¡å¼
- ğŸ”§ **å·¥å…·ç”Ÿæ€ä¸°å¯Œ**ï¼šå†…ç½®ä»£ç è§£é‡Šã€æ·±åº¦æœç´¢ã€æŠ¥å‘Šç”Ÿæˆç­‰å¤šç§AIå·¥å…·
- ğŸŒ **MCPåè®®æ”¯æŒ**ï¼šå¯æ‰©å±•æ¥å…¥å¤–éƒ¨å·¥å…·å’ŒæœåŠ¡
- ğŸ“Š **å¤šæ ¼å¼è¾“å‡º**ï¼šæ”¯æŒHTMLã€PPTã€Markdownã€Excelç­‰å¤šç§æ ¼å¼
- ğŸ¯ **GAIAæ¦œå•75.15%**ï¼šåœ¨æƒå¨è¯„æµ‹ä¸­è¶…è¶Šå¤šä¸ªçŸ¥åäº§å“

### 1.2 æŠ€æœ¯æ¶æ„äº®ç‚¹

- **æ··åˆè¯­è¨€æ¶æ„**ï¼šJavaè´Ÿè´£ä¸šåŠ¡ç¼–æ’ï¼ŒPythonè´Ÿè´£AIå·¥å…·å®ç°
- **å¾®æœåŠ¡è®¾è®¡**ï¼šå‰åç«¯åˆ†ç¦»ï¼ŒæœåŠ¡è§£è€¦ï¼Œæ˜“äºæ‰©å±•
- **æµå¼å¤„ç†**ï¼šæ”¯æŒSSEå®æ—¶æ¨é€ï¼Œæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒ
- **æ™ºèƒ½ä½“ç¼–æ’**ï¼šæ”¯æŒå¤æ‚ä»»åŠ¡çš„è‡ªåŠ¨æ‹†è§£å’Œæ‰§è¡Œ

---

## 2. æ•´ä½“æ¶æ„è®¾è®¡

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯UIå±‚      â”‚    â”‚   Javaåç«¯      â”‚    â”‚  Pythonå·¥å…·å±‚   â”‚
â”‚   (React/TS)   â”‚â—„â”€â”€â–ºâ”‚  (Spring Boot)  â”‚â—„â”€â”€â–ºâ”‚   (FastAPI)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
         â”‚              â”‚   LLMæœåŠ¡       â”‚             â”‚
         â”‚              â”‚ (OpenAI/Claude) â”‚             â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
         â”‚                       â”‚                       â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
         â”‚              â”‚   MCPåè®®       â”‚             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   å¤–éƒ¨å·¥å…·      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æœåŠ¡ç»„ä»¶è¯¦è§£

| ç»„ä»¶ | æŠ€æœ¯æ ˆ | ç«¯å£ | èŒè´£ |
|------|--------|------|------|
| **genie-backend** | Java 17 + Spring Boot 3.2.2 | 8080 | ä¸»æ§æœåŠ¡ã€Agentç¼–æ’ã€APIç½‘å…³ |
| **genie-tool** | Python 3.11 + FastAPI | 1601 | AIå·¥å…·é›†ã€ä»£ç è§£é‡Šã€æœç´¢ã€æŠ¥å‘Šç”Ÿæˆ |
| **genie-client** | Python 3.11 | 8188 | MCPå®¢æˆ·ç«¯ã€å·¥å…·ä»£ç† |
| **ui** | React 19 + TypeScript + Vite | 3000 | ç”¨æˆ·ç•Œé¢ã€å®æ—¶äº¤äº’ |

### 2.3 æ•°æ®æµè½¬å›¾

```
ç”¨æˆ·è¾“å…¥ â†’ å‰ç«¯UI â†’ Javaåç«¯ â†’ Agenté€‰æ‹© â†’ ä»»åŠ¡æ‹†è§£
                    â†“
              LLMæ¨¡å‹è°ƒç”¨ â† å·¥å…·æ‰§è¡Œ â† Pythonå·¥å…·æœåŠ¡
                    â†“
              ç»“æœèšåˆ â†’ SSEæ¨é€ â†’ å‰ç«¯å±•ç¤º
```

---

## 3. Javaåç«¯æœåŠ¡è¯¦è§£

### 3.1 æ ¸å¿ƒæ¶æ„

Javaåç«¯åŸºäºSpring Bootæ„å»ºï¼Œé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼š

```
Controllerå±‚ (APIæ¥å£)
    â†“
Serviceå±‚ (ä¸šåŠ¡é€»è¾‘)
    â†“
Agentå±‚ (æ™ºèƒ½ä½“æ ¸å¿ƒ)
    â†“
Toolå±‚ (å·¥å…·è°ƒç”¨)
    â†“
LLMå±‚ (å¤§æ¨¡å‹æ¥å£)
```

### 3.2 æ™ºèƒ½ä½“æ ¸å¿ƒè®¾è®¡

#### 3.2.1 BaseAgent æŠ½è±¡åŸºç±»

```java
public abstract class BaseAgent {
    // æ ¸å¿ƒå±æ€§
    private String name;                    // Agentåç§°
    private String description;             // Agentæè¿°
    private String systemPrompt;            // ç³»ç»Ÿæç¤ºè¯
    private ToolCollection availableTools;  // å¯ç”¨å·¥å…·é›†åˆ
    private Memory memory;                  // è®°å¿†ç®¡ç†
    protected LLM llm;                     // å¤§æ¨¡å‹æ¥å£
    
    // æ‰§è¡Œæ§åˆ¶
    private AgentState state;              // AgentçŠ¶æ€
    private int maxSteps = 10;             // æœ€å¤§æ‰§è¡Œæ­¥æ•°
    private int currentStep = 0;           // å½“å‰æ­¥æ•°
    
    // æ ¸å¿ƒæ–¹æ³•
    public abstract String step();         // æ‰§è¡Œå•æ­¥
    public String run(String query);      // è¿è¡Œä¸»å¾ªç¯
}
```

#### 3.2.2 ReActAgent å®ç°

ReActæ¨¡å¼æ˜¯"Reasoning + Acting"çš„ç»“åˆï¼Œé€šè¿‡æ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿçš„å¾ªç¯æ¥è§£å†³é—®é¢˜ï¼š

```java
public abstract class ReActAgent extends BaseAgent {
    public abstract boolean think();  // æ€è€ƒè¿‡ç¨‹
    public abstract String act();     // æ‰§è¡Œè¡ŒåŠ¨
    
    @Override
    public String step() {
        boolean shouldAct = think();
        if (!shouldAct) {
            return "Thinking complete - no action needed";
        }
        return act();
    }
}
```

#### 3.2.3 PlanningAgent è§„åˆ’æ™ºèƒ½ä½“

è´Ÿè´£ä»»åŠ¡æ‹†è§£å’Œè§„åˆ’ï¼š

```java
public class PlanningAgent extends ReActAgent {
    private PlanningTool planningTool;
    
    @Override
    public boolean think() {
        // åˆ†æç”¨æˆ·éœ€æ±‚ï¼Œåˆ¶å®šä»»åŠ¡è®¡åˆ’
        // è°ƒç”¨LLMè¿›è¡Œæ€è€ƒå’Œæ¨ç†
    }
    
    @Override
    public String act() {
        // æ‰§è¡Œè§„åˆ’å·¥å…·ï¼Œç”Ÿæˆä»»åŠ¡åˆ—è¡¨
        // è¿”å›ä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œçš„ä»»åŠ¡
    }
}
```

#### 3.2.4 ExecutorAgent æ‰§è¡Œæ™ºèƒ½ä½“

è´Ÿè´£å…·ä½“ä»»åŠ¡æ‰§è¡Œï¼š

```java
public class ExecutorAgent extends ReActAgent {
    @Override
    public boolean think() {
        // åˆ†æå½“å‰ä»»åŠ¡ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·
    }
    
    @Override
    public String act() {
        // è°ƒç”¨ç›¸åº”å·¥å…·æ‰§è¡Œä»»åŠ¡
        // å¤„ç†å·¥å…·è¿”å›ç»“æœ
    }
}
```

### 3.3 å·¥å…·ç³»ç»Ÿæ¶æ„

#### 3.3.1 å·¥å…·æ¥å£è®¾è®¡

```java
public interface BaseTool {
    String getName();                    // å·¥å…·åç§°
    String getDescription();             // å·¥å…·æè¿°
    Map<String, Object> toParams();      // å·¥å…·å‚æ•°è§„èŒƒ
    Object execute(Object input);       // æ‰§è¡Œå·¥å…·
}
```

#### 3.3.2 å†…ç½®å·¥å…·å®ç°

| å·¥å…·åç§° | å®ç°ç±» | åŠŸèƒ½æè¿° |
|----------|--------|----------|
| **FileTool** | `FileTool.java` | æ–‡ä»¶è¯»å†™ã€ä¸Šä¼ ä¸‹è½½ |
| **CodeInterpreterTool** | `CodeInterpreterTool.java` | ä»£ç è§£é‡Šæ‰§è¡Œ |
| **DeepSearchTool** | `DeepSearchTool.java` | æ·±åº¦æœç´¢ |
| **ReportTool** | `ReportTool.java` | æŠ¥å‘Šç”Ÿæˆ |
| **McpTool** | `McpTool.java` | MCPåè®®å·¥å…· |

#### 3.3.3 å·¥å…·é›†åˆç®¡ç†

```java
public class ToolCollection {
    private Map<String, BaseTool> toolMap;           // å·¥å…·æ˜ å°„
    private Map<String, McpToolInfo> mcpToolMap;     // MCPå·¥å…·æ˜ å°„
    
    public void addTool(BaseTool tool);              // æ·»åŠ å·¥å…·
    public Object execute(String name, Object args); // æ‰§è¡Œå·¥å…·
}
```

### 3.4 LLMé›†æˆæ¶æ„

#### 3.4.1 LLMæŠ½è±¡å±‚

```java
public class LLM {
    private String model;           // æ¨¡å‹åç§°
    private String apiKey;          // APIå¯†é’¥
    private String baseUrl;         // åŸºç¡€URL
    private int maxTokens;          // æœ€å¤§tokenæ•°
    private double temperature;     // æ¸©åº¦å‚æ•°
    
    // åŒæ­¥è°ƒç”¨
    public CompletableFuture<String> ask(
        AgentContext context,
        List<Message> messages,
        List<Message> systemMsgs,
        boolean stream,
        Double temperature
    );
    
    // æµå¼è°ƒç”¨
    public CompletableFuture<String> askStream(...);
}
```

#### 3.4.2 æ”¯æŒçš„æ¨¡å‹

- **OpenAIç³»åˆ—**ï¼šGPT-4ã€GPT-3.5ã€GPT-4-turbo
- **Anthropic**ï¼šClaude-3-Sonnetã€Claude-3-Haiku
- **å›½äº§å¤§æ¨¡å‹**ï¼šæ–‡å¿ƒä¸€è¨€ã€é€šä¹‰åƒé—®ã€æ™ºè°±GLMç­‰
- **è‡ªå®šä¹‰æ¨¡å‹**ï¼šæ”¯æŒOpenAIå…¼å®¹çš„ä»»ä½•API

### 3.5 æ ¸å¿ƒé…ç½®è¯¦è§£

åœ¨`application.yml`ä¸­çš„å…³é”®é…ç½®ï¼š

```yaml
# LLMé…ç½®
llm:
  default:
    base_url: '<LLMæœåŠ¡åœ°å€>'
    apikey: '<APIå¯†é’¥>'
    model: 'gpt-4.1'
    max_tokens: 8192
    temperature: 0

# Agenté…ç½®
autobots:
  autoagent:
    planner:
      max_steps: 40
      model_name: 'gpt-4.1'
    executor:
      max_steps: 40
      model_name: 'gpt-4.1'
    react:
      max_steps: 40
      model_name: 'claude-3-7-sonnet-v1'

# å·¥å…·æœåŠ¡åœ°å€
code_interpreter_url: "http://127.0.0.1:1601"
deep_search_url: "http://127.0.0.1:1601"
mcp_client_url: "http://127.0.0.1:8188"
```

---

## 4. Pythonå·¥å…·æœåŠ¡è¯¦è§£

### 4.1 FastAPIæœåŠ¡æ¶æ„

Pythonå·¥å…·æœåŠ¡ä½¿ç”¨FastAPIæ„å»ºï¼Œæä¾›é«˜æ€§èƒ½çš„å¼‚æ­¥APIï¼š

```python
app = FastAPI()

# æ ¸å¿ƒè·¯ç”±
@router.post("/code_interpreter")  # ä»£ç è§£é‡Š
@router.post("/report")            # æŠ¥å‘Šç”Ÿæˆ  
@router.post("/deepsearch")        # æ·±åº¦æœç´¢
```

### 4.2 ä»£ç è§£é‡Šå™¨è¯¦è§£

#### 4.2.1 æ¶æ„è®¾è®¡

ä»£ç è§£é‡Šå™¨åŸºäº`smolagents`æ¡†æ¶ï¼Œæä¾›å®‰å…¨çš„Pythonä»£ç æ‰§è¡Œç¯å¢ƒï¼š

```python
async def code_interpreter_agent(
    task: str,                    # ä»»åŠ¡æè¿°
    file_names: List[str] = None, # è¾“å…¥æ–‡ä»¶
    max_tokens: int = 32000,      # æœ€å¤§token
    request_id: str = "",         # è¯·æ±‚ID
    stream: bool = True,          # æ˜¯å¦æµå¼
):
    # 1. åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•
    work_dir = tempfile.mkdtemp()
    
    # 2. ä¸‹è½½è¾“å…¥æ–‡ä»¶
    import_files = await download_all_files_in_path(file_names, work_dir)
    
    # 3. æ–‡ä»¶å†…å®¹åˆ†æå’Œæ‘˜è¦
    files = []
    for file in import_files:
        # Excel/CSVæ–‡ä»¶å¤„ç†
        if file_name.endswith(('.xlsx', '.xls', '.csv')):
            df = pd.read_excel(file_path) if excel else pd.read_csv(file_path)
            content = df.head(10).to_string()  # é¢„è§ˆå‰10è¡Œ
        
        # æ–‡æœ¬æ–‡ä»¶å¤„ç†  
        elif file_name.endswith(('.txt', '.md', '.py')):
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()[:max_file_abstract_size]
        
        files.append({
            "file_name": file_name,
            "file_path": file_path,
            "content": content
        })
    
    # 4. æ„å»ºä»»åŠ¡æç¤ºè¯
    prompt = get_prompt("code_interpreter")["system_prompt"]
    task_prompt = Template(prompt).render(
        task=task,
        files=files,
        output_dir="./output"
    )
    
    # 5. åˆå§‹åŒ–AIä»£ç†
    model = LiteLLMModel(model_id="gpt-4.1")
    agent = CIAgent(
        tools=[PythonInterpreterTool()],
        model=model,
        max_steps=10
    )
    
    # 6. æµå¼æ‰§è¡Œ
    async for chunk in agent.run_stream(task_prompt):
        if isinstance(chunk, CodeOuput):
            yield chunk  # ä»£ç è¾“å‡º
        elif isinstance(chunk, ActionOutput):
            yield chunk  # æ‰§è¡Œç»“æœ
        else:
            yield chunk  # ä¸­é—´çŠ¶æ€
```

#### 4.2.2 å®‰å…¨æœºåˆ¶

- **æ²™ç®±ç¯å¢ƒ**ï¼šæ¯æ¬¡æ‰§è¡Œéƒ½åœ¨ç‹¬ç«‹çš„ä¸´æ—¶ç›®å½•ä¸­è¿›è¡Œ
- **èµ„æºé™åˆ¶**ï¼šé™åˆ¶æ‰§è¡Œæ—¶é—´ã€å†…å­˜ä½¿ç”¨å’Œæ–‡ä»¶è®¿é—®
- **ä»£ç å®¡æŸ¥**ï¼šå¯¹ç”¨æˆ·ä»£ç è¿›è¡Œå®‰å…¨æ€§æ£€æŸ¥
- **æ–‡ä»¶éš”ç¦»**ï¼šè¾“å…¥è¾“å‡ºæ–‡ä»¶ä¸¥æ ¼éš”ç¦»ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²

### 4.3 æ·±åº¦æœç´¢å¼•æ“

#### 4.3.1 æœç´¢æ¶æ„

```python
class DeepSearch:
    def __init__(self, engines: List[str] = None):
        self.engines = engines or ["google", "bing", "duckduckgo"]
        self.current_docs = []
        self.searched_queries = set()
    
    async def run(self, query: str, max_loop: int = 1) -> AsyncGenerator[str, None]:
        """æ·±åº¦æœç´¢ä¸»æµç¨‹"""
        for loop in range(max_loop):
            # 1. æŸ¥è¯¢åˆ†è§£
            sub_queries = await query_decompose(query)
            
            # 2. å¹¶è¡Œæœç´¢
            searched_docs, docs_list = await self._search_queries_and_dedup(sub_queries)
            
            # 3. å†…å®¹æ•´åˆ
            self.current_docs.extend(searched_docs)
            
            # 4. ç­”æ¡ˆç”Ÿæˆ
            answer = await answer_question(query, self.current_docs)
            
            yield answer
```

#### 4.3.2 æœç´¢ä¼˜åŒ–

- **æŸ¥è¯¢åˆ†è§£**ï¼šå°†å¤æ‚æŸ¥è¯¢æ‹†è§£ä¸ºå¤šä¸ªå­æŸ¥è¯¢
- **å¹¶è¡Œæœç´¢**ï¼šåŒæ—¶ä½¿ç”¨å¤šä¸ªæœç´¢å¼•æ“
- **å†…å®¹å»é‡**ï¼šåŸºäºå†…å®¹ç›¸ä¼¼åº¦å»é™¤é‡å¤ç»“æœ
- **ç»“æœæ’åº**ï¼šæ ¹æ®ç›¸å…³æ€§å’Œæƒå¨æ€§æ’åº
- **å¢é‡æœç´¢**ï¼šæ”¯æŒå¤šè½®æœç´¢ç»†åŒ–ç»“æœ

### 4.4 æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ

#### 4.4.1 å¤šæ ¼å¼æ”¯æŒ

```python
async def report(
    task: str,
    file_names: List[str] = None,
    file_type: str = "markdown"  # markdown/html/ppt
) -> AsyncGenerator[str, None]:
    
    # 1. å†…å®¹æ”¶é›†å’Œæ•´ç†
    content_data = await collect_content(file_names)
    
    # 2. æ ¹æ®ç±»å‹é€‰æ‹©æ¨¡æ¿
    if file_type == "html":
        template = get_html_template()
    elif file_type == "ppt":
        template = get_ppt_template()
    else:
        template = get_markdown_template()
    
    # 3. LLMç”Ÿæˆå†…å®¹
    async for chunk in ask_llm(
        messages=build_report_prompt(task, content_data, template),
        model="gpt-4.1",
        stream=True
    ):
        yield chunk
```

#### 4.4.2 æ¨¡æ¿ç³»ç»Ÿ

- **HTMLæ¨¡æ¿**ï¼šå“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå›¾è¡¨å’Œäº¤äº’
- **PPTæ¨¡æ¿**ï¼šä¸“ä¸šå•†åŠ¡é£æ ¼ï¼Œè‡ªåŠ¨ç”Ÿæˆå¹»ç¯ç‰‡
- **Markdownæ¨¡æ¿**ï¼šæ”¯æŒä»£ç é«˜äº®ã€è¡¨æ ¼ã€å›¾ç‰‡
- **è‡ªå®šä¹‰æ¨¡æ¿**ï¼šæ”¯æŒç”¨æˆ·å®šä¹‰æ ·å¼å’Œå¸ƒå±€

### 4.5 å·¥å…·æ‰©å±•æœºåˆ¶

#### 4.5.1 å·¥å…·æ³¨å†Œ

```python
# æ–°å·¥å…·å®ç°
class CustomTool:
    async def execute(self, task: str, **kwargs):
        # è‡ªå®šä¹‰é€»è¾‘
        return result

# æ³¨å†Œåˆ°APIè·¯ç”±
@router.post("/custom_tool")
async def custom_tool_endpoint(body: CustomRequest):
    tool = CustomTool()
    result = await tool.execute(body.task)
    return {"code": 200, "data": result}
```

#### 4.5.2 ä¾èµ–ç®¡ç†

ä½¿ç”¨`pyproject.toml`ç®¡ç†Pythonä¾èµ–ï¼š

```toml
[project]
dependencies = [
    "fastapi>=0.115.14",      # Webæ¡†æ¶
    "smolagents>=1.19.0",     # Agentæ¡†æ¶
    "litellm>=1.74.0",        # LLMç»Ÿä¸€æ¥å£
    "pandas>=2.3.0",          # æ•°æ®å¤„ç†
    "beautifulsoup4>=4.13.4", # ç½‘é¡µè§£æ
    "matplotlib>=3.10.3",     # å›¾è¡¨ç”Ÿæˆ
    "openpyxl>=3.1.5",        # Excelå¤„ç†
]
```

---

## 5. å‰ç«¯Reactåº”ç”¨è¯¦è§£

### 5.1 æŠ€æœ¯æ ˆä¸æ¶æ„

å‰ç«¯ä½¿ç”¨ç°ä»£åŒ–çš„ReactæŠ€æœ¯æ ˆï¼š

```json
{
  "æ ¸å¿ƒæ¡†æ¶": "React 19 + TypeScript",
  "æ„å»ºå·¥å…·": "Vite 6.1.0",
  "UIç»„ä»¶åº“": "Ant Design 5.26.3",
  "è·¯ç”±ç®¡ç†": "React Router 7.6.2",
  "æ ·å¼æ–¹æ¡ˆ": "Tailwind CSS 4.1.11",
  "çŠ¶æ€ç®¡ç†": "ahooks 3.9.0",
  "å®æ—¶é€šä¿¡": "@microsoft/fetch-event-source"
}
```

### 5.2 ç»„ä»¶æ¶æ„è®¾è®¡

```
src/
â”œâ”€â”€ components/           # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ ChatView/        # èŠå¤©è§†å›¾
â”‚   â”œâ”€â”€ ActionPanel/     # æ“ä½œé¢æ¿
â”‚   â”œâ”€â”€ ActionView/      # åŠ¨ä½œè§†å›¾
â”‚   â”œâ”€â”€ PlanView/        # è®¡åˆ’è§†å›¾
â”‚   â””â”€â”€ LoadingSpinner/  # åŠ è½½ç»„ä»¶
â”œâ”€â”€ pages/               # é¡µé¢ç»„ä»¶
â”œâ”€â”€ services/            # APIæœåŠ¡
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ types/               # ç±»å‹å®šä¹‰
â””â”€â”€ hooks/               # è‡ªå®šä¹‰Hooks
```

### 5.3 å®æ—¶é€šä¿¡æœºåˆ¶

#### 5.3.1 SSEè¿æ¥å®ç°

```typescript
// querySSE.ts
export default (config: SSEConfig, url: string = DEFAULT_SSE_URL): void => {
  const { body, handleMessage, handleError, handleClose } = config;

  fetchEventSource(url, {
    method: 'POST',
    credentials: 'include',
    headers: {
      'Content-Type': 'application/json',
      'Cache-Control': 'no-cache',
      'Connection': 'keep-alive',
      'Accept': 'text/event-stream',
    },
    body: JSON.stringify(body),
    openWhenHidden: true,
    
    onmessage(event: EventSourceMessage) {
      if (event.data) {
        const parsedData = JSON.parse(event.data);
        handleMessage(parsedData);
      }
    },
    
    onerror(error: Error) {
      console.error('SSE error:', error);
      handleError(error);
    },
    
    onclose() {
      console.log('SSE connection closed');
      handleClose();
    }
  });
};
```

#### 5.3.2 æ¶ˆæ¯å¤„ç†æœºåˆ¶

```typescript
// ChatViewç»„ä»¶ä¸­çš„æ¶ˆæ¯å¤„ç†
const sendMessage = useMemoizedFn((inputInfo: CHAT.TInputInfo) => {
  const {message, deepThink, outputStyle} = inputInfo;
  const requestId = getUniqId();
  
  // æ„å»ºè¯·æ±‚å‚æ•°
  const params = {
    sessionId: sessionId,
    requestId: requestId,
    query: message,
    deepThink: deepThink ? 1 : 0,
    outputStyle
  };
  
  // æ¶ˆæ¯å¤„ç†å›è°ƒ
  const handleMessage = (data: MESSAGE.Answer) => {
    const { finished, resultMap, packageType, status } = data;
    
    if (packageType !== "heartbeat") {
      requestAnimationFrame(() => {
        if (resultMap?.eventData) {
          // æ›´æ–°èŠå¤©æ•°æ®
          currentChat = combineData(resultMap.eventData || {}, currentChat);
          
          // å¤„ç†ä»»åŠ¡æ•°æ®
          const taskData = handleTaskData(currentChat, deepThink, currentChat.multiAgent);
          setTaskList(taskData.taskList);
          updatePlan(taskData.plan!);
          
          if (finished) {
            currentChat.loading = false;
            setLoading(false);
          }
        }
      });
    }
  };
  
  // å¯åŠ¨SSEè¿æ¥
  querySSE({ body: params, handleMessage, handleError, handleClose });
});
```

### 5.4 å¤šåª’ä½“å†…å®¹æ¸²æŸ“

#### 5.4.1 ActionPanelç»„ä»¶

è´Ÿè´£æ¸²æŸ“ä¸åŒç±»å‹çš„æ‰§è¡Œç»“æœï¼š

```typescript
const ActionPanel: GenieType.FC<ActionPanelProps> = ({ taskItem }) => {
  const msgTypes = useMsgTypes(taskItem);
  const { markDownContent } = useContent(taskItem);
  
  const renderContent = () => {
    const { useHtml, useCode, useFile, useExcel, useJSON, searchList, usePpt } = msgTypes || {};
    
    // æœç´¢ç»“æœåˆ—è¡¨
    if (searchList?.length) {
      return <SearchListRenderer list={searchList} />;
    }
    
    // HTML/PPTæ¸²æŸ“
    if (useHtml || usePpt) {
      return (
        <HTMLRenderer
          htmlUrl={htmlUrl}
          downloadUrl={downloadHtmlUrl}
          outputCode={codeOutput}
          showToolBar={allowShowToolBar && resultMap?.isFinal}
        />
      );
    }
    
    // Excelè¡¨æ ¼æ¸²æŸ“
    if (useExcel) {
      return <TableRenderer fileUrl={fileInfo?.domainUrl} fileName={fileInfo?.fileName} />;
    }
    
    // æ–‡ä»¶é¢„è§ˆ
    if (useFile) {
      return <FileRenderer fileUrl={fileInfo?.domainUrl} fileName={fileInfo?.fileName} />;
    }
    
    // JSONæ•°æ®æ¸²æŸ“
    if (useJSON) {
      return <ReactJsonPretty data={JSON.parse(toolResult?.toolResult || '{}')} />;
    }
    
    // é»˜è®¤Markdownæ¸²æŸ“
    return <MarkdownRenderer markDownContent={markDownContent} />;
  };
  
  return renderContent();
};
```

#### 5.4.2 æ–‡ä»¶ç±»å‹æ”¯æŒ

| æ–‡ä»¶ç±»å‹ | æ¸²æŸ“ç»„ä»¶ | æ”¯æŒåŠŸèƒ½ |
|----------|----------|----------|
| **HTML/PPT** | `HTMLRenderer` | å†…åµŒiframeé¢„è§ˆã€ä¸‹è½½ |
| **Excel/CSV** | `TableRenderer` | è¡¨æ ¼å±•ç¤ºã€æ’åºã€ç­›é€‰ |
| **Markdown** | `MarkdownRenderer` | ä»£ç é«˜äº®ã€æ•°å­¦å…¬å¼ |
| **JSON** | `ReactJsonPretty` | è¯­æ³•é«˜äº®ã€æŠ˜å å±•å¼€ |
| **å›¾ç‰‡** | `FileRenderer` | ç¼©ç•¥å›¾ã€æ”¾å¤§é¢„è§ˆ |
| **PDF** | `FileRenderer` | åœ¨çº¿é¢„è§ˆã€ä¸‹è½½ |

### 5.5 çŠ¶æ€ç®¡ç†ä¸æ•°æ®æµ

#### 5.5.1 Chatæ•°æ®ç»“æ„

```typescript
interface ChatData {
  sessionId: string;           // ä¼šè¯ID
  requestId: string;           // è¯·æ±‚ID
  message: string;             // ç”¨æˆ·æ¶ˆæ¯
  loading: boolean;            // åŠ è½½çŠ¶æ€
  multiAgent: boolean;         // å¤šæ™ºèƒ½ä½“æ¨¡å¼
  taskList: Task[];            // ä»»åŠ¡åˆ—è¡¨
  plan: Plan;                  // æ‰§è¡Œè®¡åˆ’
  resultMap: ResultMap;        // ç»“æœæ˜ å°„
}

interface Task {
  messageType: string;         // æ¶ˆæ¯ç±»å‹
  toolResult: ToolResult;      // å·¥å…·ç»“æœ
  status: 'pending' | 'running' | 'completed' | 'failed';
}
```

#### 5.5.2 å“åº”å¼æ›´æ–°æœºåˆ¶

```typescript
// ä½¿ç”¨ahooksç®¡ç†çŠ¶æ€
const [chatList, setChatList] = useState<ChatData[]>([]);
const [taskList, setTaskList] = useState<Task[]>([]);
const [loading, setLoading] = useState(false);

// å®æ—¶æ›´æ–°èŠå¤©åˆ—è¡¨
const updateChatList = useMemoizedFn((newChat: ChatData) => {
  setChatList(prev => {
    const newList = [...prev];
    const index = newList.findIndex(chat => chat.requestId === newChat.requestId);
    if (index >= 0) {
      newList[index] = newChat;
    } else {
      newList.push(newChat);
    }
    return newList;
  });
});
```

---

## 6. æŠ€æœ¯é€‰å‹ä¸è®¾è®¡ç†å¿µ

### 6.1 æ¶æ„è®¾è®¡åŸåˆ™

#### 6.1.1 èŒè´£åˆ†ç¦»åŸåˆ™

**ä¸ºä»€ä¹ˆé€‰æ‹©Java + Pythonæ··åˆæ¶æ„ï¼Ÿ**

1. **Javaåç«¯çš„ä¼˜åŠ¿ï¼š**
   - ğŸ¢ **ä¼ä¸šçº§ç¨³å®šæ€§**ï¼šå¼ºç±»å‹ã€æˆç†Ÿç”Ÿæ€ã€æ˜“ç»´æŠ¤
   - âš¡ **é«˜å¹¶å‘æ€§èƒ½**ï¼šJVMä¼˜åŒ–ã€çº¿ç¨‹æ± ã€è¿æ¥æ± 
   - ğŸ”§ **ä¸šåŠ¡é€»è¾‘å¤æ‚åº¦**ï¼šé€‚åˆå¤æ‚çš„æµç¨‹ç¼–æ’å’ŒçŠ¶æ€ç®¡ç†
   - ğŸ›¡ï¸ **å®‰å…¨å¯æ§**ï¼šä¸¥æ ¼çš„æƒé™ç®¡ç†å’Œå¼‚å¸¸å¤„ç†

2. **Pythonå·¥å…·æœåŠ¡çš„ä¼˜åŠ¿ï¼š**
   - ğŸ§  **AIç”Ÿæ€ä¸°å¯Œ**ï¼šnumpyã€pandasã€scikit-learnç­‰
   - ğŸš€ **å¼€å‘æ•ˆç‡é«˜**ï¼šç®€æ´è¯­æ³•ã€å¿«é€ŸåŸå‹
   - ğŸ”Œ **é›†æˆä¾¿æ·**ï¼šä¸LLMã€æ·±åº¦å­¦ä¹ æ¡†æ¶æ— ç¼å¯¹æ¥
   - ğŸ“Š **æ•°æ®å¤„ç†å¼º**ï¼šå¤©ç„¶é€‚åˆæ•°æ®åˆ†æå’Œå¤„ç†

#### 6.1.2 å¾®æœåŠ¡åŒ–è®¾è®¡

```
å•ä½“åº”ç”¨ âŒ          å¾®æœåŠ¡æ¶æ„ âœ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚             â”‚      â”‚ UI   â”‚ â”‚Backendâ”‚ â”‚Tools â”‚
â”‚    ALL-IN   â”‚  â†’   â”‚      â”‚ â”‚      â”‚ â”‚      â”‚
â”‚    ONE      â”‚      â”‚ 3000 â”‚ â”‚ 8080 â”‚ â”‚ 1601 â”‚
â”‚             â”‚      â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¾®æœåŠ¡ä¼˜åŠ¿ï¼š**
- ğŸ”„ **ç‹¬ç«‹éƒ¨ç½²**ï¼šå„æœåŠ¡å¯ç‹¬ç«‹æ›´æ–°ã€å›æ»š
- ğŸ“ˆ **æ°´å¹³æ‰©å±•**ï¼šæ ¹æ®è´Ÿè½½ç‹¬ç«‹æ‰©å®¹
- ğŸ› ï¸ **æŠ€æœ¯å¤šæ ·æ€§**ï¼šå„æœåŠ¡å¯ä½¿ç”¨æœ€é€‚åˆçš„æŠ€æœ¯æ ˆ
- ğŸ” **æ•…éšœéš”ç¦»**ï¼šå•ä¸ªæœåŠ¡æ•…éšœä¸å½±å“æ•´ä½“ç³»ç»Ÿ

### 6.2 æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼

#### 6.2.1 ReAct vs Planning & Executor

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|----------|------|------|
| **ReAct** | ç®€å•ç›´æ¥çš„é—®ç­” | å®æ—¶å“åº”å¿«ã€é€»è¾‘æ¸…æ™° | å¤æ‚ä»»åŠ¡å®¹æ˜“è¿·å¤±æ–¹å‘ |
| **Planning & Executor** | å¤æ‚å¤šæ­¥éª¤ä»»åŠ¡ | å…¨å±€è§„åˆ’ã€æ­¥éª¤æ¸…æ™° | åˆå§‹è§„åˆ’æ—¶é—´è¾ƒé•¿ |

#### 6.2.2 å¤šå±‚çº§æ€è€ƒæœºåˆ¶

```
Work Level (å·¥ä½œçº§åˆ«)
â”œâ”€â”€ Task 1: ä¿¡æ¯æ”¶é›†
â”œâ”€â”€ Task 2: æ•°æ®åˆ†æ  
â””â”€â”€ Task 3: æŠ¥å‘Šç”Ÿæˆ

Task Level (ä»»åŠ¡çº§åˆ«)
â”œâ”€â”€ Step 1: æœç´¢ç›¸å…³èµ„æ–™
â”œâ”€â”€ Step 2: ç­›é€‰æœ‰æ•ˆä¿¡æ¯
â””â”€â”€ Step 3: æ•´ç†æˆæ–‡æ¡£
```

### 6.3 æµå¼å¤„ç†è®¾è®¡

#### 6.3.1 ä¸ºä»€ä¹ˆé€‰æ‹©SSEè€ŒéWebSocketï¼Ÿ

| ç‰¹æ€§ | SSE | WebSocket |
|------|-----|-----------|
| **åè®®å¤æ‚åº¦** | ç®€å•HTTP | å¤æ‚æ¡æ‰‹åè®® |
| **æµè§ˆå™¨æ”¯æŒ** | åŸç”Ÿæ”¯æŒ | éœ€è¦é¢å¤–å¤„ç† |
| **æœåŠ¡ç«¯æ¨é€** | âœ… ä¸“ä¸ºæ­¤è®¾è®¡ | âœ… åŒå‘é€šä¿¡ |
| **æ–­çº¿é‡è¿** | âœ… è‡ªåŠ¨é‡è¿ | âŒ éœ€æ‰‹åŠ¨å®ç° |
| **è´Ÿè½½å‡è¡¡** | âœ… HTTPå…¼å®¹ | âŒ çŠ¶æ€ç»‘å®š |

#### 6.3.2 æµå¼å¤„ç†ä¼˜åŠ¿

```python
# ä¼ ç»ŸåŒæ­¥æ–¹å¼ âŒ
def process_request(query):
    result = heavy_computation(query)  # ç”¨æˆ·ç­‰å¾…30ç§’
    return result

# æµå¼å¼‚æ­¥æ–¹å¼ âœ…  
async def process_request_stream(query):
    async for chunk in heavy_computation_stream(query):
        yield chunk  # ç”¨æˆ·å®æ—¶çœ‹åˆ°è¿›å±•
```

### 6.4 å·¥å…·æ‰©å±•æ€§è®¾è®¡

#### 6.4.1 MCPåè®®é›†æˆ

MCP (Model Context Protocol) æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œå…è®¸AIåº”ç”¨å®‰å…¨åœ°è¿æ¥åˆ°å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·ï¼š

```java
// Javaç«¯MCPå·¥å…·è°ƒç”¨
public class McpTool implements BaseTool {
    public String callTool(String serverUrl, String toolName, Object input) {
        // é€šè¿‡MCPå®¢æˆ·ç«¯è°ƒç”¨å¤–éƒ¨å·¥å…·
        String mcpClientUrl = config.getMcpClientUrl() + "/v1/tool/call";
        McpToolRequest request = McpToolRequest.builder()
            .name(toolName)
            .server_url(serverUrl)
            .arguments(params)
            .build();
        return OkHttpUtil.postJson(mcpClientUrl, JSON.toJSONString(request));
    }
}
```

#### 6.4.2 æ’ä»¶åŒ–æ¶æ„

```
æ ¸å¿ƒç³»ç»Ÿ
    â†“
å·¥å…·æ¥å£å±‚ (BaseTool)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å†…ç½®å·¥å…· â”‚Pythonå·¥å…·â”‚MCPå·¥å…· â”‚è‡ªå®šä¹‰å·¥å…·â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. éƒ¨ç½²ä¸è¿ç»´æŒ‡å—

### 7.1 ç¯å¢ƒè¦æ±‚

#### 7.1.1 ç³»ç»Ÿè¦æ±‚

| ç»„ä»¶ | æœ€ä½é…ç½® | æ¨èé…ç½® |
|------|----------|----------|
| **CPU** | 4æ ¸ | 8æ ¸ä»¥ä¸Š |
| **å†…å­˜** | 8GB | 16GBä»¥ä¸Š |
| **å­˜å‚¨** | 50GB | 100GBä»¥ä¸Š |
| **æ“ä½œç³»ç»Ÿ** | Ubuntu 20.04+ / CentOS 8+ | Ubuntu 22.04 LTS |

#### 7.1.2 è½¯ä»¶ä¾èµ–

```bash
# Javaç¯å¢ƒ
java -version  # OpenJDK 17+

# Pythonç¯å¢ƒ  
python --version  # Python 3.11+
pip install uv    # UVåŒ…ç®¡ç†å™¨

# Node.jsç¯å¢ƒ
node --version  # Node.js 18+
pnpm --version  # PNPM 7.0+

# å®¹å™¨ç¯å¢ƒ(å¯é€‰)
docker --version  # Docker 20.0+
```

### 7.2 éƒ¨ç½²æ–¹å¼

#### 7.2.1 Dockerä¸€é”®éƒ¨ç½² (æ¨è)

```bash
# 1. å…‹éš†ä»£ç 
git clone https://github.com/jd-opensource/joyagent-jdgenie.git
cd joyagent-jdgenie

# 2. é…ç½®ç¯å¢ƒå˜é‡
cd genie-tool
cp .env_template .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œè®¾ç½®OPENAI_API_KEYå’ŒOPENAI_BASE_URL

# 3. æ„å»ºé•œåƒ
cd ..
docker build -t genie:latest .

# 4. è¿è¡Œå®¹å™¨
docker run -d \
  -p 3000:3000 \
  -p 8080:8080 \
  -p 1601:1601 \
  -e OPENAI_BASE_URL="ä½ çš„LLMæœåŠ¡åœ°å€" \
  -e OPENAI_API_KEY="ä½ çš„APIå¯†é’¥" \
  --name genie-app \
  genie:latest
```

#### 7.2.2 æ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. åç«¯æœåŠ¡å¯åŠ¨
cd genie-backend
mvn clean package -DskipTests
java -jar target/genie-backend-0.0.1-SNAPSHOT.jar

# 2. Pythonå·¥å…·æœåŠ¡å¯åŠ¨
cd genie-tool
uv sync
source .venv/bin/activate
python server.py --host 0.0.0.0 --port 1601

# 3. MCPå®¢æˆ·ç«¯å¯åŠ¨
cd genie-client
uv sync
source .venv/bin/activate
python server.py --host 0.0.0.0 --port 8188

# 4. å‰ç«¯æœåŠ¡å¯åŠ¨
cd ui
pnpm install
pnpm build
pnpm preview --host 0.0.0.0 --port 3000
```

#### 7.2.3 ä¸€é”®å¯åŠ¨è„šæœ¬

```bash
# ä½¿ç”¨é¡¹ç›®æä¾›çš„å¯åŠ¨è„šæœ¬
chmod +x start_genie.sh
./start_genie.sh
```

### 7.3 é…ç½®ç®¡ç†

#### 7.3.1 Javaåç«¯é…ç½®

ä¸»è¦é…ç½®æ–‡ä»¶ï¼š`genie-backend/src/main/resources/application.yml`

```yaml
# æœåŠ¡ç«¯å£
server:
  port: 8080

# LLMé…ç½®
llm:
  default:
    base_url: '${OPENAI_BASE_URL:http://localhost:8080/v1}'
    apikey: '${OPENAI_API_KEY:your-api-key}'
    model: '${LLM_MODEL:gpt-4.1}'
    max_tokens: 8192
    temperature: 0

# å·¥å…·æœåŠ¡åœ°å€
autobots:
  code_interpreter_url: "http://127.0.0.1:1601"
  deep_search_url: "http://127.0.0.1:1601"
  mcp_client_url: "http://127.0.0.1:8188"
  mcp_server_url: "ä½ çš„MCPæœåŠ¡åœ°å€"

# Agenté…ç½®
autoagent:
  planner:
    max_steps: 40
    model_name: '${LLM_MODEL:gpt-4.1}'
  executor:
    max_steps: 40
    model_name: '${LLM_MODEL:gpt-4.1}'
```

#### 7.3.2 Pythonå·¥å…·é…ç½®

ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š`genie-tool/.env`

```bash
# LLMé…ç½®
OPENAI_API_KEY=your-openai-api-key
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_API_BASE=https://api.openai.com/v1

# æ¨¡å‹é…ç½®
DEFAULT_MODEL=gpt-4.1
SEARCH_MODEL=gpt-4.1
SEARCH_REASONING_MODEL=gpt-4.1

# æœåŠ¡é…ç½®
FILE_SERVER_URL=http://127.0.0.1:1601
LOG_PATH=./logs/server.log

# æœç´¢é…ç½®
SEARCH_ENGINES=google,bing,duckduckgo
SEARCH_THREAD_NUM=5
SINGLE_PAGE_MAX_SIZE=200

# æ€§èƒ½é…ç½®
MAX_FILE_ABSTRACT_SIZE=2000
MAX_TOKENS=32000
```

### 7.4 ç›‘æ§ä¸æ—¥å¿—

#### 7.4.1 æ—¥å¿—é…ç½®

```yaml
# Javaæ—¥å¿—é…ç½®
logging:
  level:
    root: INFO
    com.jd.genie: DEBUG
  file:
    name: logs/genie-backend.log
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
```

```python
# Pythonæ—¥å¿—é…ç½®
from loguru import logger

logger.add(
    "logs/genie-tool.log",
    format="{time:YYYY-MM-DD HH:mm:ss.SSS} {level} {module}.{function} {message}",
    rotation="200 MB",
    retention="30 days"
)
```

#### 7.4.2 å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:8080/web/health     # Javaåç«¯
curl http://localhost:1601/docs           # Pythonå·¥å…·æœåŠ¡
curl http://localhost:3000                # å‰ç«¯æœåŠ¡
```

#### 7.4.3 æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats genie-app

# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
ps aux | grep java     # Javaè¿›ç¨‹
ps aux | grep python   # Pythonè¿›ç¨‹
ps aux | grep node     # Node.jsè¿›ç¨‹

# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tlnp | grep -E '(3000|8080|1601|8188)'
```

### 7.5 æ•…éšœæ’æŸ¥

#### 7.5.1 å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i:8080
lsof -i:1601
lsof -i:3000

# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $OPENAI_API_KEY
echo $OPENAI_BASE_URL

# æ£€æŸ¥ä¾èµ–
java -version
python --version
node --version
```

**é—®é¢˜2ï¼šLLMè°ƒç”¨å¤±è´¥**
```bash
# æµ‹è¯•APIè¿é€šæ€§
curl -X POST "${OPENAI_BASE_URL}/chat/completions" \
  -H "Authorization: Bearer ${OPENAI_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4.1",
    "messages": [{"role": "user", "content": "test"}],
    "max_tokens": 50
  }'
```

**é—®é¢˜3ï¼šå‰ç«¯æ— æ³•è¿æ¥åç«¯**
```bash
# æ£€æŸ¥è·¨åŸŸé…ç½®
curl -H "Origin: http://localhost:3000" \
     -H "Access-Control-Request-Method: POST" \
     -X OPTIONS http://localhost:8080/AutoAgent
```

#### 7.5.2 æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹Javaåç«¯æ—¥å¿—
tail -f genie-backend/logs/genie-backend.log | grep ERROR

# æŸ¥çœ‹Pythonå·¥å…·æ—¥å¿—  
tail -f genie-tool/logs/server.log | grep ERROR

# æŸ¥çœ‹å‰ç«¯æ„å»ºæ—¥å¿—
cd ui && npm run build
```

---

## 8. å¼€å‘ä¸æ‰©å±•æŒ‡å—

### 8.1 å¼€å‘ç¯å¢ƒæ­å»º

#### 8.1.1 IDEæ¨è

**Javaå¼€å‘ï¼š**
- IntelliJ IDEA Ultimate (æ¨è)
- Eclipse with Spring Tools
- Visual Studio Code + Java Extension Pack

**Pythonå¼€å‘ï¼š**
- PyCharm Professional (æ¨è)
- Visual Studio Code + Python Extension
- Jupyter Lab (æ•°æ®åˆ†æ)

**å‰ç«¯å¼€å‘ï¼š**
- Visual Studio Code (æ¨è)
- WebStorm
- Cursor (AIè¾…åŠ©å¼€å‘)

#### 8.1.2 å¼€å‘å·¥å…·é…ç½®

**Javaé¡¹ç›®å¯¼å…¥ï¼š**
```bash
# ä½¿ç”¨IDEAå¯¼å…¥Mavené¡¹ç›®
1. File -> Open -> é€‰æ‹©genie-backendç›®å½•
2. å¯¼å…¥Mavené¡¹ç›®
3. ç­‰å¾…ä¾èµ–ä¸‹è½½å®Œæˆ
4. é…ç½®JDK 17
5. è¿è¡ŒGenieApplication.main()
```

**Pythonç¯å¢ƒé…ç½®ï¼š**
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
cd genie-tool
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
.venv\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
pip install uv
uv sync

# é…ç½®IDE Pythonè§£é‡Šå™¨ä¸º.venv/bin/python
```

**å‰ç«¯å¼€å‘ç¯å¢ƒï¼š**
```bash
cd ui
pnpm install
pnpm dev  # å¼€å‘æ¨¡å¼ï¼Œçƒ­é‡è½½
```

### 8.2 æ–°å¢æ™ºèƒ½ä½“

#### 8.2.1 åˆ›å»ºè‡ªå®šä¹‰Agent

```java
// 1. ç»§æ‰¿ReActAgentåŸºç±»
@Slf4j
@Data
@EqualsAndHashCode(callSuper = true)
public class CustomAgent extends ReActAgent {
    
    @Override
    public boolean think() {
        // åˆ†æä»»åŠ¡ï¼Œå†³å®šæ˜¯å¦éœ€è¦æ‰§è¡Œè¡ŒåŠ¨
        String query = getContext().getQuery();
        
        // è°ƒç”¨LLMè¿›è¡Œæ€è€ƒ
        List<Message> messages = Arrays.asList(
            Message.systemMessage("ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•°æ®åˆ†æå¸ˆ..."),
            Message.userMessage(query)
        );
        
        CompletableFuture<String> response = getLlm().ask(
            getContext(), messages, Collections.emptyList(), false, 0.1
        );
        
        try {
            String thought = response.get();
            log.info("Agentæ€è€ƒç»“æœ: {}", thought);
            
            // æ ¹æ®æ€è€ƒç»“æœå†³å®šæ˜¯å¦è¡ŒåŠ¨
            return thought.contains("éœ€è¦æ‰§è¡Œ") || thought.contains("è°ƒç”¨å·¥å…·");
        } catch (Exception e) {
            log.error("æ€è€ƒè¿‡ç¨‹å¼‚å¸¸", e);
            return false;
        }
    }
    
    @Override
    public String act() {
        // æ‰§è¡Œå…·ä½“è¡ŒåŠ¨
        String task = getContext().getTask();
        
        // é€‰æ‹©åˆé€‚çš„å·¥å…·æ‰§è¡Œ
        if (task.contains("æ•°æ®åˆ†æ")) {
            // è°ƒç”¨ä»£ç è§£é‡Šå™¨
            ToolCall toolCall = ToolCall.builder()
                .function(ToolCall.Function.builder()
                    .name("code_agent")
                    .arguments("{\"task\":\"" + task + "\"}")
                    .build())
                .build();
            return executeTool(toolCall);
        }
        
        return "ä»»åŠ¡æ‰§è¡Œå®Œæˆ";
    }
}

// 2. æ³¨å†Œåˆ°AgentFactory
@Component
public class CustomAgentFactory {
    
    public BaseAgent createAgent(String agentType, AgentContext context) {
        switch (agentType) {
            case "custom":
                return new CustomAgent(context);
            default:
                return new ReactImplAgent(context);
        }
    }
}
```

#### 8.2.2 Agenté…ç½®ç®¡ç†

```yaml
# application.ymlä¸­æ·»åŠ Agenté…ç½®
autobots:
  autoagent:
    custom:  # æ–°Agentç±»å‹
      system_prompt: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„XXXåŠ©æ‰‹..."
      max_steps: 20
      model_name: "gpt-4.1"
      temperature: 0.1
```

### 8.3 æ–°å¢å·¥å…·

#### 8.3.1 Javaå·¥å…·å®ç°

```java
// 1. å®ç°BaseToolæ¥å£
@Component
public class WeatherTool implements BaseTool {
    
    @Override
    public String getName() {
        return "weather_tool";
    }
    
    @Override
    public String getDescription() {
        return "è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯";
    }
    
    @Override
    public Map<String, Object> toParams() {
        Map<String, Object> params = new HashMap<>();
        params.put("type", "object");
        
        Map<String, Object> properties = new HashMap<>();
        Map<String, Object> cityParam = new HashMap<>();
        cityParam.put("type", "string");
        cityParam.put("description", "åŸå¸‚åç§°");
        properties.put("city", cityParam);
        
        params.put("properties", properties);
        params.put("required", Arrays.asList("city"));
        
        return params;
    }
    
    @Override
    public Object execute(Object input) {
        try {
            Map<String, Object> params = (Map<String, Object>) input;
            String city = (String) params.get("city");
            
            // è°ƒç”¨å¤©æ°”API
            String weatherInfo = callWeatherAPI(city);
            
            return "åŸå¸‚ï¼š" + city + "ï¼Œå¤©æ°”ï¼š" + weatherInfo;
        } catch (Exception e) {
            log.error("è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥", e);
            return "å¤©æ°”ä¿¡æ¯è·å–å¤±è´¥ï¼š" + e.getMessage();
        }
    }
    
    private String callWeatherAPI(String city) {
        // å®é™…çš„å¤©æ°”APIè°ƒç”¨é€»è¾‘
        return "æ™´å¤©ï¼Œ25Â°C";
    }
}

// 2. æ³¨å†Œå·¥å…·
@Component
public class ToolRegistrar {
    
    @PostConstruct
    public void registerTools() {
        // åœ¨GenieController.buildToolCollectionä¸­æ·»åŠ 
        WeatherTool weatherTool = new WeatherTool();
        toolCollection.addTool(weatherTool);
    }
}
```

#### 8.3.2 Pythonå·¥å…·å®ç°

```python
# 1. åˆ›å»ºå·¥å…·ç±»
class WeatherTool:
    """å¤©æ°”æŸ¥è¯¢å·¥å…·"""
    
    def __init__(self):
        self.api_key = os.getenv("WEATHER_API_KEY")
        self.base_url = "https://api.openweathermap.org/data/2.5"
    
    async def get_weather(self, city: str) -> str:
        """è·å–åŸå¸‚å¤©æ°”ä¿¡æ¯"""
        try:
            url = f"{self.base_url}/weather"
            params = {
                "q": city,
                "appid": self.api_key,
                "units": "metric",
                "lang": "zh_cn"
            }
            
            async with aiohttp.ClientSession() as session:
                async with session.get(url, params=params) as response:
                    data = await response.json()
                    
                    if response.status == 200:
                        weather = data["weather"][0]["description"]
                        temp = data["main"]["temp"]
                        return f"{city}å½“å‰å¤©æ°”ï¼š{weather}ï¼Œæ¸©åº¦ï¼š{temp}Â°C"
                    else:
                        return f"è·å–{city}å¤©æ°”ä¿¡æ¯å¤±è´¥"
                        
        except Exception as e:
            logger.error(f"å¤©æ°”æŸ¥è¯¢å¼‚å¸¸: {e}")
            return f"å¤©æ°”æŸ¥è¯¢æœåŠ¡å¼‚å¸¸: {str(e)}"

# 2. åˆ›å»ºAPIç«¯ç‚¹
@router.post("/weather")
async def get_weather(body: WeatherRequest):
    """å¤©æ°”æŸ¥è¯¢æ¥å£"""
    weather_tool = WeatherTool()
    
    async def _stream():
        result = await weather_tool.get_weather(body.city)
        
        yield ServerSentEvent(
            data=json.dumps({
                "requestId": body.request_id,
                "data": result,
                "isFinal": True
            }, ensure_ascii=False)
        )
        yield ServerSentEvent(data="[DONE]")
    
    if body.stream:
        return EventSourceResponse(_stream())
    else:
        result = await weather_tool.get_weather(body.city)
        return {"code": 200, "data": result}

# 3. å®šä¹‰è¯·æ±‚æ¨¡å‹
class WeatherRequest(BaseModel):
    city: str
    request_id: str = ""
    stream: bool = True
```

### 8.4 å‰ç«¯ç»„ä»¶å¼€å‘

#### 8.4.1 åˆ›å»ºæ–°çš„æ¸²æŸ“ç»„ä»¶

```typescript
// WeatherRenderer.tsx
interface WeatherRendererProps {
  weatherData: {
    city: string;
    temperature: number;
    description: string;
    humidity: number;
    windSpeed: number;
  };
}

const WeatherRenderer: React.FC<WeatherRendererProps> = ({ weatherData }) => {
  const { city, temperature, description, humidity, windSpeed } = weatherData;
  
  return (
    <div className="weather-card p-4 bg-blue-50 rounded-lg border border-blue-200">
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-lg font-semibold text-blue-800">{city} å¤©æ°”</h3>
        <div className="text-2xl font-bold text-blue-600">
          {temperature}Â°C
        </div>
      </div>
      
      <div className="grid grid-cols-2 gap-4 text-sm">
        <div className="flex items-center">
          <CloudIcon className="w-4 h-4 mr-2 text-gray-500" />
          <span>{description}</span>
        </div>
        
        <div className="flex items-center">
          <DropletIcon className="w-4 h-4 mr-2 text-blue-500" />
          <span>æ¹¿åº¦: {humidity}%</span>
        </div>
        
        <div className="flex items-center">
          <WindIcon className="w-4 h-4 mr-2 text-green-500" />
          <span>é£é€Ÿ: {windSpeed} m/s</span>
        </div>
      </div>
    </div>
  );
};

export default WeatherRenderer;
```

#### 8.4.2 é›†æˆåˆ°ActionPanel

```typescript
// åœ¨ActionPanel.tsxä¸­æ·»åŠ å¤©æ°”æ¸²æŸ“é€»è¾‘
const ActionPanel: GenieType.FC<ActionPanelProps> = ({ taskItem }) => {
  const renderContent = () => {
    const { toolResult } = taskItem || {};
    
    // æ£€æµ‹æ˜¯å¦ä¸ºå¤©æ°”æ•°æ®
    if (taskItem?.messageType === 'weather' && toolResult?.weatherData) {
      return <WeatherRenderer weatherData={toolResult.weatherData} />;
    }
    
    // å…¶ä»–æ¸²æŸ“é€»è¾‘...
    return <MarkdownRenderer markDownContent={markDownContent} />;
  };
  
  return <div className="action-panel">{renderContent()}</div>;
};
```

### 8.5 MCPå·¥å…·é›†æˆ

#### 8.5.1 åˆ›å»ºMCPæœåŠ¡

```python
# mcp_weather_server.py
from mcp import Server, ServerContext
from mcp.types import Tool, TextContent

class WeatherMCPServer:
    def __init__(self):
        self.server = Server("weather-server")
        self._register_tools()
    
    def _register_tools(self):
        @self.server.list_tools()
        async def list_tools() -> list[Tool]:
            return [
                Tool(
                    name="get_weather",
                    description="è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯",
                    inputSchema={
                        "type": "object",
                        "properties": {
                            "city": {
                                "type": "string",
                                "description": "åŸå¸‚åç§°"
                            }
                        },
                        "required": ["city"]
                    }
                )
            ]
        
        @self.server.call_tool()
        async def call_tool(name: str, arguments: dict) -> list[TextContent]:
            if name == "get_weather":
                city = arguments.get("city")
                # è°ƒç”¨å¤©æ°”API
                weather_info = await self._get_weather(city)
                return [TextContent(type="text", text=weather_info)]
            else:
                raise ValueError(f"æœªçŸ¥å·¥å…·: {name}")
    
    async def _get_weather(self, city: str) -> str:
        # å®é™…çš„å¤©æ°”æŸ¥è¯¢é€»è¾‘
        return f"{city}å½“å‰å¤©æ°”ï¼šæ™´å¤©ï¼Œæ¸©åº¦ï¼š25Â°C"

# å¯åŠ¨MCPæœåŠ¡
if __name__ == "__main__":
    server = WeatherMCPServer()
    server.run(host="localhost", port=9000)
```

#### 8.5.2 é…ç½®MCPæœåŠ¡åœ°å€

```yaml
# application.yml
autobots:
  mcp_server_url: "http://localhost:9000,http://your-custom-mcp-server"
```

### 8.6 æµ‹è¯•ä¸è°ƒè¯•

#### 8.6.1 å•å…ƒæµ‹è¯•

```java
// Javaå•å…ƒæµ‹è¯•
@SpringBootTest
@TestPropertySource(locations = "classpath:application-test.properties")
class WeatherToolTest {
    
    @Autowired
    private WeatherTool weatherTool;
    
    @Test
    void testGetWeather() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        Map<String, Object> input = new HashMap<>();
        input.put("city", "åŒ—äº¬");
        
        // æ‰§è¡Œæµ‹è¯•
        Object result = weatherTool.execute(input);
        
        // éªŒè¯ç»“æœ
        assertThat(result).isInstanceOf(String.class);
        assertThat((String) result).contains("åŒ—äº¬");
    }
}
```

```python
# Pythonå•å…ƒæµ‹è¯•
import pytest
from unittest.mock import AsyncMock, patch

@pytest.mark.asyncio
async def test_weather_tool():
    weather_tool = WeatherTool()
    
    with patch('aiohttp.ClientSession.get') as mock_get:
        # æ¨¡æ‹ŸAPIå“åº”
        mock_response = AsyncMock()
        mock_response.status = 200
        mock_response.json.return_value = {
            "weather": [{"description": "æ™´å¤©"}],
            "main": {"temp": 25}
        }
        mock_get.return_value.__aenter__.return_value = mock_response
        
        # æ‰§è¡Œæµ‹è¯•
        result = await weather_tool.get_weather("åŒ—äº¬")
        
        # éªŒè¯ç»“æœ
        assert "åŒ—äº¬" in result
        assert "æ™´å¤©" in result
        assert "25Â°C" in result
```

#### 8.6.2 é›†æˆæµ‹è¯•

```bash
# æµ‹è¯•å®Œæ•´æµç¨‹
curl -X POST http://localhost:8080/AutoAgent \
  -H "Content-Type: application/json" \
  -d '{
    "requestId": "test-001",
    "query": "æŸ¥è¯¢åŒ—äº¬çš„å¤©æ°”æƒ…å†µ",
    "agentType": "react"
  }'
```

#### 8.6.3 æ€§èƒ½æµ‹è¯•

```bash
# ä½¿ç”¨abè¿›è¡Œå‹åŠ›æµ‹è¯•
ab -n 100 -c 10 -T application/json \
   -p test_data.json \
   http://localhost:8080/AutoAgent

# ç›‘æ§ç³»ç»Ÿèµ„æº
htop
iotop
nethogs
```

---

## 9. APIæ¥å£æ–‡æ¡£

### 9.1 Javaåç«¯API

#### 9.1.1 æ™ºèƒ½ä½“è°ƒç”¨æ¥å£

**POST /AutoAgent**

å¯åŠ¨æ™ºèƒ½ä½“ä»»åŠ¡ï¼Œæ”¯æŒSSEæµå¼è¿”å›ã€‚

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "requestId": "uuid-string",        // è¯·æ±‚IDï¼Œå”¯ä¸€æ ‡è¯†
  "sessionId": "session-uuid",       // ä¼šè¯IDï¼Œå¯é€‰
  "query": "ç”¨æˆ·æŸ¥è¯¢å†…å®¹",            // ç”¨æˆ·è¾“å…¥çš„ä»»åŠ¡æè¿°
  "agentType": "react",              // æ™ºèƒ½ä½“ç±»å‹ï¼šreact/planning
  "deepThink": 1,                    // æ˜¯å¦æ·±åº¦æ€è€ƒï¼š0/1
  "outputStyle": "html",             // è¾“å‡ºæ ¼å¼ï¼šhtml/docs/table/ppt
  "sopPrompt": "è‡ªå®šä¹‰æç¤ºè¯",        // å¯é€‰ï¼Œè‡ªå®šä¹‰ç³»ç»Ÿæç¤º
  "basePrompt": "åŸºç¡€æç¤ºè¯",         // å¯é€‰ï¼ŒåŸºç¡€æç¤ºè¯
  "isStream": true                   // æ˜¯å¦æµå¼è¾“å‡º
}
```

**å“åº”æ ¼å¼ (SSEæµ)ï¼š**
```json
// ä»»åŠ¡è¿›åº¦äº‹ä»¶
{
  "requestId": "uuid-string",
  "eventType": "task_progress",
  "data": {
    "currentStep": 1,
    "totalSteps": 3,
    "taskName": "ä¿¡æ¯æ”¶é›†",
    "status": "running"
  },
  "timestamp": "2025-01-22T10:30:00Z"
}

// å·¥å…·æ‰§è¡Œäº‹ä»¶
{
  "requestId": "uuid-string", 
  "eventType": "tool_execution",
  "data": {
    "toolName": "deep_search",
    "input": {"query": "æœç´¢å†…å®¹"},
    "output": "æœç´¢ç»“æœ...",
    "executionTime": 1500
  }
}

// æœ€ç»ˆç»“æœäº‹ä»¶
{
  "requestId": "uuid-string",
  "eventType": "final_result",
  "data": {
    "summary": "ä»»åŠ¡å®Œæˆæ‘˜è¦",
    "files": [
      {
        "fileName": "åˆ†ææŠ¥å‘Š.html",
        "fileUrl": "http://localhost:1601/preview/uuid/report.html",
        "fileType": "html",
        "fileSize": 102400
      }
    ],
    "executionTime": 30000
  },
  "finished": true
}
```

#### 9.1.2 æµå¼æŸ¥è¯¢æ¥å£

**POST /web/api/v1/gpt/queryAgentStreamIncr**

å¢é‡å¼æµå¼æŸ¥è¯¢ï¼Œæ”¯æŒå®æ—¶äº¤äº’ã€‚

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "sessionId": "session-uuid",
  "requestId": "request-uuid", 
  "query": "ç”¨æˆ·æŸ¥è¯¢å†…å®¹",
  "deepThink": 0,
  "outputStyle": "html"
}
```

#### 9.1.3 å¥åº·æ£€æŸ¥æ¥å£

**GET /web/health**

æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥ã€‚

**å“åº”ï¼š**
```
HTTP 200 OK
Content-Type: text/plain

ok
```

### 9.2 Pythonå·¥å…·API

#### 9.2.1 ä»£ç è§£é‡Šå™¨æ¥å£

**POST /code_interpreter**

æ‰§è¡ŒPythonä»£ç å¹¶è¿”å›ç»“æœã€‚

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "task": "åˆ†æä¸Šä¼ çš„Excelæ–‡ä»¶ï¼Œç”Ÿæˆç»Ÿè®¡å›¾è¡¨",
  "file_names": [
    "http://localhost:1601/files/data.xlsx"
  ],
  "request_id": "uuid-string",
  "stream": true,
  "stream_mode": {
    "mode": "general",    // general/token/time
    "token": 10,          // tokenæ¨¡å¼ä¸‹çš„tokenæ•°
    "time": 1.0          // timeæ¨¡å¼ä¸‹çš„æ—¶é—´é—´éš”(ç§’)
  },
  "file_name": "åˆ†æç»“æœ.html",
  "file_type": "html"
}
```

**å“åº”æ ¼å¼ (SSEæµ)ï¼š**
```json
// ä»£ç ç”Ÿæˆäº‹ä»¶
{
  "requestId": "uuid-string",
  "code": "import pandas as pd\ndf = pd.read_excel('data.xlsx')",
  "fileInfo": [],
  "isFinal": false
}

// ä»£ç æ‰§è¡Œç»“æœ
{
  "requestId": "uuid-string", 
  "codeOutput": "æ‰§è¡Œç»“æœè¾“å‡º...",
  "fileInfo": [
    {
      "fileName": "chart.png",
      "domainUrl": "http://localhost:1601/preview/uuid/chart.png",
      "ossUrl": "http://localhost:1601/download/uuid/chart.png"
    }
  ],
  "isFinal": true
}
```

#### 9.2.2 æ·±åº¦æœç´¢æ¥å£

**POST /deepsearch**

æ‰§è¡Œå¤šè½®æ·±åº¦æœç´¢å¹¶ç”Ÿæˆç­”æ¡ˆã€‚

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "query": "åˆ†æ2024å¹´äººå·¥æ™ºèƒ½å‘å±•è¶‹åŠ¿",
  "request_id": "uuid-string",
  "max_loop": 2,
  "search_engines": ["google", "bing", "duckduckgo"],
  "stream_mode": {
    "mode": "general"
  }
}
```

**å“åº”æ ¼å¼ï¼š**
```json
// æœç´¢è¿‡ç¨‹äº‹ä»¶
{
  "requestId": "uuid-string",
  "query": "2024å¹´äººå·¥æ™ºèƒ½å‘å±•è¶‹åŠ¿",
  "searchResult": {
    "query": ["AIå‘å±•è¶‹åŠ¿", "2024äººå·¥æ™ºèƒ½"], 
    "docs": [
      [
        {
          "title": "2024å¹´AIå‘å±•æŠ¥å‘Š",
          "url": "https://example.com/ai-report",
          "content": "æ–‡æ¡£å†…å®¹æ‘˜è¦...",
          "score": 0.95
        }
      ]
    ]
  },
  "isFinal": false,
  "messageType": "search"
}

// ç­”æ¡ˆç”Ÿæˆäº‹ä»¶
{
  "requestId": "uuid-string",
  "answer": "æ ¹æ®æœç´¢ç»“æœåˆ†æï¼Œ2024å¹´AIå‘å±•å‘ˆç°ä»¥ä¸‹è¶‹åŠ¿...",
  "isFinal": true,
  "messageType": "report"
}
```

#### 9.2.3 æŠ¥å‘Šç”Ÿæˆæ¥å£

**POST /report**

ç”ŸæˆæŒ‡å®šæ ¼å¼çš„æŠ¥å‘Šæ–‡æ¡£ã€‚

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "task": "åŸºäºæœç´¢ç»“æœç”ŸæˆAIå‘å±•è¶‹åŠ¿åˆ†ææŠ¥å‘Š",
  "file_names": ["http://localhost:1601/files/search_result.md"],
  "file_type": "html",     // markdown/html/ppt
  "file_name": "AIè¶‹åŠ¿åˆ†ææŠ¥å‘Š.html",
  "request_id": "uuid-string",
  "stream": true,
  "stream_mode": {
    "mode": "general"
  }
}
```

**å“åº”æ ¼å¼ï¼š**
```json
// å†…å®¹ç”Ÿæˆè¿‡ç¨‹
{
  "requestId": "uuid-string",
  "data": "# AIå‘å±•è¶‹åŠ¿åˆ†ææŠ¥å‘Š\n\n## æ¦‚è¿°\n...",
  "isFinal": false
}

// æœ€ç»ˆæ–‡ä»¶ç”Ÿæˆ
{
  "requestId": "uuid-string",
  "data": "å®Œæ•´çš„æŠ¥å‘Šå†…å®¹...",
  "fileInfo": [
    {
      "fileName": "AIè¶‹åŠ¿åˆ†ææŠ¥å‘Š.html",
      "domainUrl": "http://localhost:1601/preview/uuid/report.html",
      "ossUrl": "http://localhost:1601/download/uuid/report.html",
      "fileSize": 204800
    }
  ],
  "isFinal": true
}
```

### 9.3 MCPå®¢æˆ·ç«¯API

#### 9.3.1 å·¥å…·åˆ—è¡¨æ¥å£

**POST /v1/tool/list**

è·å–MCPæœåŠ¡å™¨çš„å¯ç”¨å·¥å…·åˆ—è¡¨ã€‚

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "server_url": "http://localhost:9000"
}
```

**å“åº”ï¼š**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "name": "get_weather",
      "description": "è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯",
      "inputSchema": {
        "type": "object",
        "properties": {
          "city": {
            "type": "string",
            "description": "åŸå¸‚åç§°"
          }
        },
        "required": ["city"]
      }
    }
  ]
}
```

#### 9.3.2 å·¥å…·è°ƒç”¨æ¥å£

**POST /v1/tool/call**

è°ƒç”¨MCPæœåŠ¡å™¨çš„ç‰¹å®šå·¥å…·ã€‚

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "server_url": "http://localhost:9000",
  "name": "get_weather",
  "arguments": {
    "city": "åŒ—äº¬"
  }
}
```

**å“åº”ï¼š**
```json
{
  "code": 200,
  "message": "success", 
  "data": "åŒ—äº¬å½“å‰å¤©æ°”ï¼šæ™´å¤©ï¼Œæ¸©åº¦ï¼š25Â°Cï¼Œæ¹¿åº¦ï¼š60%"
}
```

### 9.4 é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | æè¿° | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| **400** | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•°æ ¼å¼å’Œå¿…å¡«å­—æ®µ |
| **401** | è®¤è¯å¤±è´¥ | æ£€æŸ¥APIå¯†é’¥é…ç½® |
| **429** | è¯·æ±‚é¢‘ç‡è¶…é™ | å‡å°‘è¯·æ±‚é¢‘ç‡æˆ–è”ç³»ç®¡ç†å‘˜ |
| **500** | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼Œè”ç³»æŠ€æœ¯æ”¯æŒ |
| **503** | æœåŠ¡ä¸å¯ç”¨ | æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡æ¢å¤ |
| **1001** | LLMè°ƒç”¨å¤±è´¥ | æ£€æŸ¥LLMæœåŠ¡é…ç½®å’Œç½‘ç»œè¿æ¥ |
| **1002** | å·¥å…·æ‰§è¡Œè¶…æ—¶ | æ£€æŸ¥å·¥å…·æœåŠ¡çŠ¶æ€ï¼Œé‡è¯•è¯·æ±‚ |
| **1003** | æ–‡ä»¶å¤„ç†å¤±è´¥ | æ£€æŸ¥æ–‡ä»¶æ ¼å¼å’Œå¤§å°é™åˆ¶ |

---

## 10. å¸¸è§é—®é¢˜ä¸æ•…éšœæ’æŸ¥

### 10.1 éƒ¨ç½²ç›¸å…³é—®é¢˜

#### Q1: Dockerå®¹å™¨å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶ï¼š** å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡ºï¼Œæˆ–è€…æœåŠ¡æ— æ³•è®¿é—®ã€‚

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs genie-app

# 2. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a

# 3. è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it genie-app /bin/bash

# 4. æ£€æŸ¥ç«¯å£æ˜ å°„
docker port genie-app
```

**å¸¸è§åŸå› ä¸è§£å†³æ–¹æ¡ˆï¼š**
- **ç«¯å£å†²çª**ï¼šä½¿ç”¨`netstat -tlnp`æ£€æŸ¥ç«¯å£å ç”¨ï¼Œä¿®æ”¹docker runå‘½ä»¤ä¸­çš„ç«¯å£æ˜ å°„
- **ç¯å¢ƒå˜é‡æœªè®¾ç½®**ï¼šç¡®ä¿OPENAI_API_KEYå’ŒOPENAI_BASE_URLæ­£ç¡®è®¾ç½®
- **å†…å­˜ä¸è¶³**ï¼šå¢åŠ Dockerå†…å­˜é™åˆ¶æˆ–æœåŠ¡å™¨å†…å­˜
- **æƒé™é—®é¢˜**ï¼šç¡®ä¿Dockeræœ‰è¶³å¤Ÿæƒé™è®¿é—®æ–‡ä»¶ç³»ç»Ÿ

#### Q2: æ‰‹åŠ¨éƒ¨ç½²ä¾èµ–å®‰è£…å¤±è´¥

**ç—‡çŠ¶ï¼š** Maven/NPM/Pythonä¾èµ–ä¸‹è½½å¤±è´¥æˆ–ç‰ˆæœ¬å†²çªã€‚

**Javaä¾èµ–é—®é¢˜ï¼š**
```bash
# æ¸…ç†Mavenç¼“å­˜
mvn clean install -U

# è·³è¿‡æµ‹è¯•æ„å»º
mvn clean package -DskipTests

# æ£€æŸ¥Javaç‰ˆæœ¬
java -version  # ç¡®ä¿æ˜¯JDK 17+
```

**Pythonä¾èµ–é—®é¢˜ï¼š**
```bash
# æ›´æ–°pipå’Œuv
pip install --upgrade pip uv

# æ¸…ç†è™šæ‹Ÿç¯å¢ƒé‡å»º
rm -rf .venv
python -m venv .venv
source .venv/bin/activate
uv sync

# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version  # ç¡®ä¿æ˜¯3.11+
```

**Node.jsä¾èµ–é—®é¢˜ï¼š**
```bash
# æ¸…ç†node_moduleså’Œlockæ–‡ä»¶
rm -rf node_modules pnpm-lock.yaml

# é‡æ–°å®‰è£…
pnpm install

# æ£€æŸ¥Nodeç‰ˆæœ¬
node --version  # ç¡®ä¿æ˜¯18+
pnpm --version  # ç¡®ä¿æ˜¯7.0+
```

### 10.2 æœåŠ¡è¿è¡Œé—®é¢˜

#### Q3: LLM APIè°ƒç”¨å¤±è´¥

**ç—‡çŠ¶ï¼š** Agentæ‰§è¡Œæ—¶æŠ¥LLMè°ƒç”¨é”™è¯¯ï¼Œæˆ–è€…å“åº”è¶…æ—¶ã€‚

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æµ‹è¯•APIè¿é€šæ€§
curl -X POST "${OPENAI_BASE_URL}/chat/completions" \
  -H "Authorization: Bearer ${OPENAI_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4.1",
    "messages": [{"role": "user", "content": "test"}],
    "max_tokens": 10
  }'

# 2. æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $OPENAI_API_KEY
echo $OPENAI_BASE_URL

# 3. æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f genie-backend/logs/application.log | grep -i llm
```

**å¸¸è§é—®é¢˜ï¼š**
- **APIå¯†é’¥é”™è¯¯**ï¼šç¡®è®¤OPENAI_API_KEYæ­£ç¡®ä¸”æœ‰æ•ˆ
- **URLé…ç½®é”™è¯¯**ï¼šæ£€æŸ¥OPENAI_BASE_URLæ ¼å¼ï¼Œç¡®ä¿ä»¥/v1ç»“å°¾
- **æ¨¡å‹ä¸å­˜åœ¨**ï¼šç¡®è®¤é…ç½®çš„æ¨¡å‹åç§°åœ¨APIæœåŠ¡ä¸­å¯ç”¨
- **ç½‘ç»œé—®é¢˜**ï¼šæ£€æŸ¥é˜²ç«å¢™å’Œä»£ç†è®¾ç½®
- **é…é¢ä¸è¶³**ï¼šæ£€æŸ¥APIè´¦æˆ·ä½™é¢å’Œè°ƒç”¨é™åˆ¶

#### Q4: å·¥å…·æœåŠ¡è°ƒç”¨å¼‚å¸¸

**ç—‡çŠ¶ï¼š** ä»£ç è§£é‡Šã€æœç´¢ç­‰å·¥å…·æ— æ³•æ­£å¸¸å·¥ä½œã€‚

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥Pythonå·¥å…·æœåŠ¡çŠ¶æ€
curl http://localhost:1601/docs

# 2. æŸ¥çœ‹å·¥å…·æœåŠ¡æ—¥å¿—
tail -f genie-tool/logs/server.log

# 3. æµ‹è¯•å…·ä½“å·¥å…·API
curl -X POST http://localhost:1601/code_interpreter \
  -H "Content-Type: application/json" \
  -d '{
    "task": "print(\"hello world\")",
    "request_id": "test",
    "stream": false
  }'
```

**å¸¸è§é—®é¢˜ï¼š**
- **æœåŠ¡æœªå¯åŠ¨**ï¼šæ£€æŸ¥Pythonè™šæ‹Ÿç¯å¢ƒå’ŒæœåŠ¡è¿›ç¨‹
- **ä¾èµ–ç¼ºå¤±**ï¼šç¡®ä¿æ‰€æœ‰Pythonä¾èµ–å·²æ­£ç¡®å®‰è£…
- **æ–‡ä»¶æƒé™**ï¼šæ£€æŸ¥ä¸´æ—¶ç›®å½•å’Œè¾“å‡ºç›®å½•çš„è¯»å†™æƒé™
- **èµ„æºé™åˆ¶**ï¼šæ£€æŸ¥å†…å­˜å’Œç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³

#### Q5: å‰ç«¯é¡µé¢æ— æ³•è®¿é—®

**ç—‡çŠ¶ï¼š** æµè§ˆå™¨æ— æ³•æ‰“å¼€å‰ç«¯é¡µé¢ï¼Œæˆ–è€…é¡µé¢åŠ è½½å¼‚å¸¸ã€‚

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥å‰ç«¯æœåŠ¡çŠ¶æ€
curl http://localhost:3000

# 2. æŸ¥çœ‹å‰ç«¯æ„å»ºæ—¥å¿—
cd ui && pnpm build

# 3. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping localhost
telnet localhost 3000
```

**å¸¸è§é—®é¢˜ï¼š**
- **ç«¯å£å†²çª**ï¼š3000ç«¯å£è¢«å ç”¨ï¼Œä¿®æ”¹ç«¯å£æˆ–åœæ­¢å†²çªæœåŠ¡
- **æ„å»ºå¤±è´¥**ï¼šæ£€æŸ¥TypeScriptç¼–è¯‘é”™è¯¯å’Œä¾èµ–é—®é¢˜
- **ä»£ç†é…ç½®**ï¼šæ£€æŸ¥vite.config.tsä¸­çš„ä»£ç†è®¾ç½®
- **æµè§ˆå™¨ç¼“å­˜**ï¼šæ¸…ç†æµè§ˆå™¨ç¼“å­˜å’Œæœ¬åœ°å­˜å‚¨

### 10.3 åŠŸèƒ½ä½¿ç”¨é—®é¢˜

#### Q6: ä»»åŠ¡æ‰§è¡Œè¶…æ—¶æˆ–å¤±è´¥

**ç—‡çŠ¶ï¼š** Agentä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œæˆ–è€…ä¸­é€”å¤±è´¥ã€‚

**æ’æŸ¥æ€è·¯ï¼š**
1. **æ£€æŸ¥ä»»åŠ¡å¤æ‚åº¦**ï¼šè¿‡äºå¤æ‚çš„ä»»åŠ¡å¯èƒ½éœ€è¦æ‹†åˆ†
2. **æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—**ï¼šè§‚å¯Ÿæ¯ä¸ªæ­¥éª¤çš„æ‰§è¡Œæƒ…å†µ
3. **è°ƒæ•´é…ç½®å‚æ•°**ï¼šå¢åŠ max_stepsæˆ–timeoutè®¾ç½®
4. **ä¼˜åŒ–æç¤ºè¯**ï¼šè®©ä»»åŠ¡æè¿°æ›´æ¸…æ™°å…·ä½“

**ä¼˜åŒ–å»ºè®®ï¼š**
```yaml
# è°ƒæ•´Agenté…ç½®
autobots:
  autoagent:
    planner:
      max_steps: 50      # å¢åŠ æœ€å¤§æ­¥æ•°
    executor:
      max_steps: 50
      max_observe: 15000 # å¢åŠ è§‚å¯Ÿé™åˆ¶
```

#### Q7: ç”Ÿæˆçš„æŠ¥å‘Šè´¨é‡ä¸ä½³

**ç—‡çŠ¶ï¼š** ç”Ÿæˆçš„HTML/PPTæŠ¥å‘Šå†…å®¹ä¸å‡†ç¡®æˆ–æ ¼å¼æ··ä¹±ã€‚

**æ”¹è¿›æ–¹æ¡ˆï¼š**
1. **ä¼˜åŒ–è¾“å…¥æ•°æ®**ï¼šç¡®ä¿è¾“å…¥æ–‡ä»¶è´¨é‡å’Œç›¸å…³æ€§
2. **è°ƒæ•´æ¨¡å‹å‚æ•°**ï¼šé™ä½temperatureæé«˜ç¨³å®šæ€§
3. **æ”¹è¿›æç¤ºè¯**ï¼šæä¾›æ›´è¯¦ç»†çš„æ ¼å¼è¦æ±‚
4. **åˆ†æ­¥ç”Ÿæˆ**ï¼šå°†å¤æ‚æŠ¥å‘Šæ‹†åˆ†æˆå¤šä¸ªå­ä»»åŠ¡

**ç¤ºä¾‹ä¼˜åŒ–ï¼š**
```python
# æä¾›æ›´å…·ä½“çš„ä»»åŠ¡æè¿°
task = """
åŸºäºæä¾›çš„æ•°æ®ç”Ÿæˆä¸“ä¸šçš„å¸‚åœºåˆ†ææŠ¥å‘Šï¼Œè¦æ±‚ï¼š
1. åŒ…å«æ‰§è¡Œæ‘˜è¦ã€æ•°æ®åˆ†æã€è¶‹åŠ¿é¢„æµ‹ä¸‰ä¸ªéƒ¨åˆ†
2. ä½¿ç”¨å›¾è¡¨å±•ç¤ºå…³é”®æ•°æ®
3. æä¾›å…·ä½“çš„å»ºè®®å’Œç»“è®º
4. æŠ¥å‘Šæ ¼å¼è¦ä¸“ä¸šç¾è§‚
"""
```

#### Q8: ä»£ç æ‰§è¡Œç»“æœä¸å‡†ç¡®

**ç—‡çŠ¶ï¼š** ä»£ç è§£é‡Šå™¨ç”Ÿæˆçš„ä»£ç æœ‰é”™è¯¯æˆ–ç»“æœä¸ç¬¦åˆé¢„æœŸã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
1. **æä¾›æ¸…æ™°çš„éœ€æ±‚æè¿°**ï¼šè¯¦ç»†è¯´æ˜æœŸæœ›çš„è¾“å‡ºæ ¼å¼
2. **åŒ…å«ç¤ºä¾‹æ•°æ®**ï¼šæä¾›æ•°æ®æ ·æœ¬å’Œé¢„æœŸç»“æœ
3. **åˆ†æ­¥æ‰§è¡Œ**ï¼šå°†å¤æ‚åˆ†ææ‹†åˆ†ä¸ºå¤šä¸ªç®€å•æ­¥éª¤
4. **éªŒè¯ä¸­é—´ç»“æœ**ï¼šæ£€æŸ¥æ¯ä¸ªæ­¥éª¤çš„è¾“å‡º

**æœ€ä½³å®è·µï¼š**
```python
# è¯¦ç»†çš„ä»»åŠ¡æè¿°ç¤ºä¾‹
task = """
åˆ†æsales_data.xlsxæ–‡ä»¶ä¸­çš„é”€å”®æ•°æ®ï¼Œå…·ä½“è¦æ±‚ï¼š
1. è¯»å–æ•°æ®å¹¶æ˜¾ç¤ºåŸºæœ¬ç»Ÿè®¡ä¿¡æ¯
2. æŒ‰æœˆä»½ç»Ÿè®¡é”€å”®é¢ï¼Œç”ŸæˆæŸ±çŠ¶å›¾
3. åˆ†æé”€å”®è¶‹åŠ¿ï¼Œè®¡ç®—æœˆåº¦å¢é•¿ç‡
4. æ‰¾å‡ºé”€å”®é¢æœ€é«˜çš„å‰5ä¸ªäº§å“
5. å°†åˆ†æç»“æœä¿å­˜ä¸ºHTMLæŠ¥å‘Š

æ•°æ®å­—æ®µè¯´æ˜ï¼š
- date: é”€å”®æ—¥æœŸ (YYYY-MM-DD)
- product: äº§å“åç§°
- sales: é”€å”®é¢
- quantity: é”€å”®æ•°é‡
"""
```

### 10.4 æ€§èƒ½ä¼˜åŒ–

#### Q9: ç³»ç»Ÿå“åº”é€Ÿåº¦æ…¢

**ä¼˜åŒ–ç­–ç•¥ï¼š**

**Javaåç«¯ä¼˜åŒ–ï¼š**
```yaml
# JVMå‚æ•°ä¼˜åŒ–
JAVA_OPTS: "-Xms2g -Xmx4g -XX:+UseG1GC -XX:MaxGCPauseMillis=200"

# è¿æ¥æ± é…ç½®
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
```

**PythonæœåŠ¡ä¼˜åŒ–ï¼š**
```python
# ä½¿ç”¨æ›´å¤šworkerè¿›ç¨‹
uvicorn.run(
    app="server:app",
    host="0.0.0.0",
    port=1601,
    workers=4,  # å¢åŠ workeræ•°é‡
    loop="uvloop"  # ä½¿ç”¨é«˜æ€§èƒ½äº‹ä»¶å¾ªç¯
)

# æ·»åŠ ç¼“å­˜æœºåˆ¶
from functools import lru_cache

@lru_cache(maxsize=100)
def cached_llm_call(prompt: str):
    # ç¼“å­˜LLMè°ƒç”¨ç»“æœ
    pass
```

**å‰ç«¯ä¼˜åŒ–ï¼š**
```typescript
// ä½¿ç”¨React.memoä¼˜åŒ–ç»„ä»¶æ¸²æŸ“
const ActionPanel = React.memo<ActionPanelProps>(({ taskItem }) => {
  // ç»„ä»¶é€»è¾‘
});

// ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ
const processedData = useMemo(() => {
  return expensiveCalculation(taskItem);
}, [taskItem]);
```

#### Q10: å†…å­˜ä½¿ç”¨è¿‡é«˜

**ç›‘æ§å’Œä¼˜åŒ–ï¼š**
```bash
# ç›‘æ§å†…å­˜ä½¿ç”¨
docker stats genie-app
htop
free -h

# Javaå†…å­˜åˆ†æ
jstack <java-pid>
jmap -dump:live,format=b,file=heap.hprof <java-pid>

# Pythonå†…å­˜åˆ†æ
pip install memory-profiler
python -m memory_profiler script.py
```

**ä¼˜åŒ–æªæ–½ï¼š**
1. **è°ƒæ•´JVMå †å¤§å°**ï¼šæ ¹æ®å®é™…éœ€è¦è®¾ç½®åˆç†çš„å†…å­˜å‚æ•°
2. **æ¸…ç†ä¸´æ—¶æ–‡ä»¶**ï¼šå®šæœŸæ¸…ç†å·¥å…·ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶
3. **ä¼˜åŒ–æ•°æ®ç»“æ„**ï¼šé¿å…åœ¨å†…å­˜ä¸­ä¿å­˜å¤§é‡æ•°æ®
4. **ä½¿ç”¨æµå¼å¤„ç†**ï¼šå¯¹å¤§æ–‡ä»¶ä½¿ç”¨æµå¼è¯»å–è€Œéä¸€æ¬¡æ€§åŠ è½½

### 10.5 å®‰å…¨ç›¸å…³

#### Q11: ä»£ç æ‰§è¡Œå®‰å…¨æ€§

**å®‰å…¨æªæ–½ï¼š**
1. **æ²™ç®±ç¯å¢ƒ**ï¼šä»£ç æ‰§è¡Œåœ¨éš”ç¦»çš„å®¹å™¨ä¸­
2. **èµ„æºé™åˆ¶**ï¼šé™åˆ¶CPUã€å†…å­˜å’Œæ‰§è¡Œæ—¶é—´
3. **æ–‡ä»¶è®¿é—®æ§åˆ¶**ï¼šé™åˆ¶æ–‡ä»¶ç³»ç»Ÿè®¿é—®èŒƒå›´
4. **ç½‘ç»œéš”ç¦»**ï¼šé™åˆ¶å¤–éƒ¨ç½‘ç»œè®¿é—®

**é…ç½®ç¤ºä¾‹ï¼š**
```python
# èµ„æºé™åˆ¶é…ç½®
EXECUTION_LIMITS = {
    "max_execution_time": 30,  # æœ€å¤§æ‰§è¡Œæ—¶é—´(ç§’)
    "max_memory_mb": 512,      # æœ€å¤§å†…å­˜ä½¿ç”¨(MB)
    "max_file_size_mb": 100,   # æœ€å¤§æ–‡ä»¶å¤§å°(MB)
    "allowed_modules": [       # å…è®¸çš„Pythonæ¨¡å—
        "pandas", "numpy", "matplotlib", "seaborn"
    ]
}
```

#### Q12: APIå¯†é’¥æ³„éœ²é˜²æŠ¤

**é˜²æŠ¤æªæ–½ï¼š**
1. **ç¯å¢ƒå˜é‡å­˜å‚¨**ï¼šä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
2. **è®¿é—®æƒé™æ§åˆ¶**ï¼šé™åˆ¶APIè®¿é—®æƒé™
3. **å®šæœŸè½®æ¢**ï¼šå®šæœŸæ›´æ¢APIå¯†é’¥
4. **ç›‘æ§å¼‚å¸¸è°ƒç”¨**ï¼šç›‘æ§APIè°ƒç”¨é‡å’Œé¢‘ç‡

**æœ€ä½³å®è·µï¼š**
```bash
# ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡
export OPENAI_API_KEY=$(aws secretsmanager get-secret-value \
  --secret-id openai-key --query SecretString --output text)

# è®¾ç½®è®¿é—®æƒé™
chmod 600 .env
chown app:app .env
```

---

## ç»“è¯­

JoyAgent-JDGenieä½œä¸ºä¸šç•Œé¦–ä¸ªå¼€æºçš„é«˜å®Œæˆåº¦å¤šæ™ºèƒ½ä½“äº§å“ï¼Œé€šè¿‡Java+Pythonçš„æ··åˆæ¶æ„è®¾è®¡ï¼Œå®ç°äº†ä»ä»»åŠ¡ç†è§£ã€è§„åˆ’æ‹†è§£åˆ°å·¥å…·æ‰§è¡Œçš„å®Œæ•´é—­ç¯ã€‚æœ¬æŠ€æœ¯æ–‡æ¡£è¯¦ç»†é˜è¿°äº†é¡¹ç›®çš„æ¶æ„è®¾è®¡ã€æ ¸å¿ƒå®ç°ã€éƒ¨ç½²è¿ç»´å’Œæ‰©å±•å¼€å‘ç­‰å„ä¸ªæ–¹é¢ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…å¿«é€Ÿç†è§£å’Œä½¿ç”¨è¿™ä¸€å¼ºå¤§çš„AI Agentå¹³å°ã€‚

### æ ¸å¿ƒä»·å€¼

1. **å¼€ç®±å³ç”¨**ï¼šæ— éœ€é¢å¤–å¼€å‘å³å¯éƒ¨ç½²ä½¿ç”¨çš„å®Œæ•´äº§å“
2. **æŠ€æœ¯å…ˆè¿›**ï¼šé‡‡ç”¨æœ€æ–°çš„AI Agentè®¾è®¡æ¨¡å¼å’Œå·¥ç¨‹å®è·µ
3. **æ‰©å±•æ€§å¼º**ï¼šæ”¯æŒMCPåè®®å’Œè‡ªå®šä¹‰å·¥å…·æ‰©å±•
4. **ç¤¾åŒºé©±åŠ¨**ï¼šå®Œå…¨å¼€æºï¼Œé¼“åŠ±ç¤¾åŒºè´¡çŒ®å’Œåä½œ

### æœªæ¥å±•æœ›

- **æ›´å¤šAgentæ¨¡å¼**ï¼šæ”¯æŒæ›´å¤šæ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼ï¼Œå¦‚ReWOOã€AutoGPTç­‰
- **å·¥å…·ç”Ÿæ€æ‰©å±•**ï¼šé›†æˆæ›´å¤šä¸“ä¸šé¢†åŸŸçš„AIå·¥å…·å’ŒæœåŠ¡
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæŒç»­ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ
- **ä¼ä¸šçº§ç‰¹æ€§**ï¼šæ·»åŠ æ›´å¤šä¼ä¸šçº§åŠŸèƒ½ï¼Œå¦‚æƒé™ç®¡ç†ã€å®¡è®¡æ—¥å¿—ç­‰

å¸Œæœ›è¿™ä»½æŠ€æœ¯æ–‡æ¡£èƒ½å¤Ÿå¸®åŠ©æ‚¨æ·±å…¥ç†è§£JoyAgent-JDGenieçš„è®¾è®¡ç†å¿µå’Œå®ç°ç»†èŠ‚ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡ŒäºŒæ¬¡å¼€å‘å’ŒåŠŸèƒ½æ‰©å±•ã€‚å¦‚æœ‰ä»»ä½•æŠ€æœ¯é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡GitHub Issuesæˆ–ç¤¾åŒºæ¸ é“ä¸æˆ‘ä»¬äº¤æµã€‚

---

**è´¡çŒ®è€…**: JoyAgent-JDGenieå¼€å‘å›¢é˜Ÿ  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ  
**é¡¹ç›®åœ°å€**: https://github.com/jd-opensource/joyagent-jdgenie 
