## æ ¸å¿ƒæ¶æ„

### 1. CDPServiceç±»è¯¦è§£

åŸºäº `steel-browser/api/src/services/cdp/cdp.service.ts`ï¼š

```typescript
import puppeteer, {
  Browser,
  BrowserContext,
  CDPSession,
  HTTPRequest,
  Page,
  Protocol,
  Target,
  TargetType,
} from "puppeteer-core";

export class CDPService extends EventEmitter {
  private browserInstance: Browser | null;
  private wsEndpoint: string | null;
  private fingerprintData: BrowserFingerprintWithHeaders | null;
  private chromeExecPath: string;
  private primaryPage: Page | null;
  private pluginManager: PluginManager;

  constructor(config: { keepAlive?: boolean }, logger: FastifyBaseLogger) {
    super();
    this.logger = logger;
    this.keepAlive = config.keepAlive ?? false;
    this.browserInstance = null;
    this.wsEndpoint = null;
    this.fingerprintData = null;
    this.chromeExecPath = getChromeExecutablePath();
    this.primaryPage = null;
    this.pluginManager = new PluginManager();
  }

  @traceable
  private async launchInternal(config?: BrowserLauncherOptions): Promise<Browser> {
    const launchTimeout = new Promise<never>((_, reject) => {
      setTimeout(() => {
        reject(new LaunchTimeoutError("Browser launch timeout"));
      }, 30000);
    });

    const launchProcess = (async () => {
      const shouldReuseInstance = this.browserInstance && this.keepAlive;
      
      if (shouldReuseInstance) {
        return this.browserInstance;
      }

      const options = config?.options ?? {};
      const timezone = await this.getTimezone(config);
      const userDataDir = await this.getUserDataDir(config);

      const launchArgs = [
        "--no-sandbox",
        "--disable-dev-shm-usage",
        "--disable-blink-features=AutomationControlled",
        "--disable-web-security",
        "--disable-site-isolation-trials",
        "--disable-features=IsolateOrigins,site-per-process",
        ...env.CHROME_ARGS,
      ].filter(Boolean).filter((arg) => !env.FILTER_CHROME_ARGS.includes(arg));

      const finalLaunchOptions = {
        ...options,
        defaultViewport: null,
        args: launchArgs,
        executablePath: this.chromeExecPath,
        timeout: 0,
        env: {
          TZ: timezone,
        },
        userDataDir,
        dumpio: env.DEBUG_CHROME_PROCESS,
      };

      // Browser process launch - most critical step
      try {
        this.browserInstance = await tracer.startActiveSpan(
          "CDPService.launchBrowser",
          async () => {
            return await puppeteer.launch(finalLaunchOptions);
          },
        ) as unknown as Browser;
      } catch (error) {
        throw new BrowserProcessError(
          error instanceof Error ? error.message : String(error),
          BrowserProcessState.LAUNCH_FAILED,
        );
      }

      return this.browserInstance;
    })();

    return Promise.race([launchProcess, launchTimeout]);
  }
}
```

### 2. æµè§ˆå™¨è¿æ¥ç¤ºä¾‹

åŸºäº `steel-browser/repl/src/script.ts`ï¼š

```typescript
import puppeteer from "puppeteer-core";

async function connectToSteelBrowser() {
  // WebSocket endpoint to connect Browser using Chrome DevTools Protocol (CDP)
  const wsEndpoint = "ws://0.0.0.0:3000";
  const browser = await puppeteer.connect({ browserWSEndpoint: wsEndpoint });
  
  try {
    const page = await browser.newPage();

    // Navigate to a website and log the title
    await page.goto("https://steel.dev");
    console.log(`Page title: ${await page.title()}`);
    
    // æ‰§è¡Œä¸€äº›è‡ªåŠ¨åŒ–æ“ä½œ
    await page.type('input[type="text"]', 'æœç´¢å†…å®¹');
    await page.click('button[type="submit"]');
    
    // ç­‰å¾…é¡µé¢åŠ è½½
    await page.waitForSelector('.search-results');
    
    // è·å–æœç´¢ç»“æœ
    const results = await page.$$eval('.search-result', elements => 
      elements.map(el => el.textContent)
    );
    
    console.log('æœç´¢ç»“æœ:', results);
    
  } finally {
    // Cleanup: close all pages and disconnect browser
    await Promise.all((await browser.pages()).map((p) => p.close()));
    await browser.disconnect();  
  }
}

connectToSteelBrowser().catch(console.error);
```

## å®æˆ˜ç¤ºä¾‹

### 1. åŸºç¡€æœç´¢ç¤ºä¾‹

```typescript
import puppeteer from 'puppeteer';

async function basicSearchExample() {
  console.log('ğŸ” å¼€å§‹åŸºç¡€æœç´¢ç¤ºä¾‹...');
  
  const browser = await puppeteer.launch({
    headless: false,
    args: ['--no-sandbox', '--disable-dev-shm-usage']
  });
  
  try {
    const page = await browser.newPage();
    
    // è®¾ç½®è§†å£å¤§å°
    await page.setViewport({ width: 1280, height: 800 });
    
    // å¯¼èˆªåˆ°ç™¾åº¦
    console.log('ğŸŒ å¯¼èˆªåˆ°ç™¾åº¦é¦–é¡µ...');
    await page.goto('https://www.baidu.com', { 
      waitUntil: 'networkidle2' 
    });
    
    // ç­‰å¾…æœç´¢æ¡†åŠ è½½
    await page.waitForSelector('#kw');
    
    // è¾“å…¥æœç´¢å…³é”®è¯
    console.log('ğŸ” æœç´¢"Puppeteeræ•™ç¨‹"...');
    await page.type('#kw', 'Puppeteeræ•™ç¨‹');
    
    // ç‚¹å‡»æœç´¢æŒ‰é’®
    await page.click('#su');
    
    // ç­‰å¾…æœç´¢ç»“æœåŠ è½½
    await page.waitForSelector('#content_left');
    
    // è·å–æœç´¢ç»“æœ
    const searchResults = await page.$$eval('.result', elements => {
      return elements.slice(0, 5).map(el => {
        const titleEl = el.querySelector('h3');
        const linkEl = el.querySelector('a');
        const snippetEl = el.querySelector('.c-abstract');
        
        return {
          title: titleEl?.textContent?.trim() || '',
          link: linkEl?.href || '',
          snippet: snippetEl?.textContent?.trim() || ''
        };
      });
    });
    
    console.log('ğŸ“‹ æœç´¢ç»“æœ:');
    searchResults.forEach((result, index) => {
      console.log(`${index + 1}. ${result.title}`);
      console.log(`   é“¾æ¥: ${result.link}`);
      console.log(`   æ‘˜è¦: ${result.snippet.substring(0, 100)}...`);
      console.log('');
    });
    
    // æˆªå›¾ä¿å­˜
    await page.screenshot({ 
      path: 'search_results.png',
      fullPage: true 
    });
    console.log('ğŸ“¸ æˆªå›¾å·²ä¿å­˜ä¸º search_results.png');
    
  } finally {
    await browser.close();
  }
}

basicSearchExample().catch(console.error);
```

### 2. è¡¨å•å¡«å†™ç¤ºä¾‹

```typescript
import puppeteer from 'puppeteer';

async function formFillingExample() {
  console.log('ğŸ“ å¼€å§‹è¡¨å•å¡«å†™ç¤ºä¾‹...');
  
  const browser = await puppeteer.launch({
    headless: false,
    args: ['--no-sandbox', '--disable-dev-shm-usage']
  });
  
  try {
    const page = await browser.newPage();
    
    // å¯¼èˆªåˆ°æµ‹è¯•è¡¨å•é¡µé¢
    await page.goto('https://httpbin.org/forms/post', {
      waitUntil: 'networkidle2'
    });
    
    // å¡«å†™è¡¨å•å­—æ®µ
    console.log('âœï¸ å¡«å†™è¡¨å•...');
    
    await page.type('input[name="custname"]', 'å¼ ä¸‰');
    await page.type('input[name="custtel"]', '138-1234-5678');
    await page.type('input[name="custemail"]', 'zhangsan@example.com');
    
    // é€‰æ‹©ä¸‹æ‹‰èœå•
    await page.select('select[name="size"]', 'medium');
    await page.select('select[name="topping"]', 'cheese');
    await page.select('select[name="delivery"]', 'now');
    
    // å¡«å†™å¤‡æ³¨
    await page.type('textarea[name="comments"]', 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è¡¨å•æäº¤');
    
    // æäº¤è¡¨å•
    console.log('ğŸ“¤ æäº¤è¡¨å•...');
    await page.click('input[type="submit"]');
    
    // ç­‰å¾…å“åº”é¡µé¢åŠ è½½
    await page.waitForSelector('pre');
    
    // è·å–å“åº”å†…å®¹
    const responseText = await page.$eval('pre', el => el.textContent);
    console.log('ğŸ“„ è¡¨å•æäº¤å“åº”:');
    console.log(responseText);
    
    // æˆªå›¾ä¿å­˜
    await page.screenshot({ 
      path: 'form_response.png',
      fullPage: true 
    });
    console.log('ğŸ“¸ å“åº”æˆªå›¾å·²ä¿å­˜ä¸º form_response.png');
    
  } finally {
    await browser.close();
  }
}

formFillingExample().catch(console.error);
```

### 3. æ•°æ®æå–ç¤ºä¾‹

```typescript
import puppeteer from 'puppeteer';
import * as fs from 'fs';

async function dataExtractionExample() {
  console.log('ğŸ“Š å¼€å§‹æ•°æ®æå–ç¤ºä¾‹...');
  
  const browser = await puppeteer.launch({
    headless: false,
    args: ['--no-sandbox', '--disable-dev-shm-usage']
  });
  
  try {
    const page = await browser.newPage();
    
    // å¯¼èˆªåˆ°æ–°é—»ç½‘ç«™
    await page.goto('https://news.ycombinator.com', {
      waitUntil: 'networkidle2'
    });
    
    // æå–æ–°é—»æ ‡é¢˜å’Œé“¾æ¥
    console.log('ğŸ“° æå–æ–°é—»æ•°æ®...');
    const newsData = await page.$$eval('.athing', elements => {
      return elements.slice(0, 10).map(el => {
        const titleEl = el.querySelector('.titleline a');
        const scoreEl = el.nextElementSibling?.querySelector('.score');
        const authorEl = el.nextElementSibling?.querySelector('.hnuser');
        
        return {
          title: titleEl?.textContent?.trim() || '',
          link: titleEl?.href || '',
          score: scoreEl?.textContent?.trim() || '0 points',
          author: authorEl?.textContent?.trim() || 'Unknown'
        };
      });
    });
    
    console.log('ğŸ“‹ æå–çš„æ–°é—»æ•°æ®:');
    newsData.forEach((item, index) => {
      console.log(`${index + 1}. ${item.title}`);
      console.log(`   åˆ†æ•°: ${item.score} | ä½œè€…: ${item.author}`);
      console.log(`   é“¾æ¥: ${item.link}`);
      console.log('');
    });
    
    // ä¿å­˜æ•°æ®åˆ°JSONæ–‡ä»¶
    const jsonData = JSON.stringify(newsData, null, 2);
    fs.writeFileSync('news_data.json', jsonData);
    console.log('ğŸ’¾ æ•°æ®å·²ä¿å­˜åˆ° news_data.json');
    
    // ç”ŸæˆCSVæ ¼å¼
    const csvHeader = 'Title,Score,Author,Link\n';
    const csvRows = newsData.map(item => 
      `"${item.title}","${item.score}","${item.author}","${item.link}"`
    ).join('\n');
    const csvData = csvHeader + csvRows;
    fs.writeFileSync('news_data.csv', csvData);
    console.log('ğŸ’¾ æ•°æ®å·²ä¿å­˜åˆ° news_data.csv');
    
  } finally {
    await browser.close();
  }
}

dataExtractionExample().catch(console.error);
```

## é«˜çº§åŠŸèƒ½

### 1. æŒ‡çº¹æ³¨å…¥å’Œåæ£€æµ‹

åŸºäºSteel-Browserçš„æŒ‡çº¹æ³¨å…¥åŠŸèƒ½ï¼š

```typescript
import { FingerprintGenerator, FingerprintInjector } from "fingerprint-generator";
import { BrowserFingerprintWithHeaders } from "fingerprint-generator";

async function setupFingerprint(page: Page) {
  // ç”Ÿæˆæµè§ˆå™¨æŒ‡çº¹
  const fingerprintGenerator = new FingerprintGenerator({
    browsers: [
      { name: "chrome", minVersion: 100 },
      { name: "firefox", minVersion: 100 },
    ],
    devices: ["desktop"],
    locales: ["en-US", "en"],
  });
  
  const fingerprintData: BrowserFingerprintWithHeaders = fingerprintGenerator.getFingerprint();
  
  // æ³¨å…¥æŒ‡çº¹åˆ°é¡µé¢
  const fingerprintInjector = new FingerprintInjector();
  await fingerprintInjector.attachFingerprintToPuppeteer(page, fingerprintData);
  
  return fingerprintData;
}

async function stealthBrowserExample() {
  const browser = await puppeteer.launch({
    headless: false,
    args: [
      '--no-sandbox',
      '--disable-blink-features=AutomationControlled',
      '--disable-web-security',
      '--disable-features=IsolateOrigins,site-per-process'
    ]
  });
  
  try {
    const page = await browser.newPage();
    
    // è®¾ç½®æŒ‡çº¹
    await setupFingerprint(page);
    
    // è®¾ç½®ç”¨æˆ·ä»£ç†
    await page.setUserAgent(
      'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
    );
    
    // è®¾ç½®è§†å£
    await page.setViewport({
      width: 1920,
      height: 1080,
      deviceScaleFactor: 1,
    });
    
    // å¯¼èˆªåˆ°åæ£€æµ‹æµ‹è¯•ç½‘ç«™
    await page.goto('https://abrahamjuliot.github.io/creepjs/');
    
    // ç­‰å¾…é¡µé¢åŠ è½½
    await page.waitForTimeout(5000);
    
    // æˆªå›¾ä¿å­˜
    await page.screenshot({ 
      path: 'stealth_test.png',
      fullPage: true 
    });
    
    console.log('âœ… åæ£€æµ‹æµ‹è¯•å®Œæˆ');
    
  } finally {
    await browser.close();
  }
}
```

### 2. æ’ä»¶ç³»ç»Ÿ

åŸºäºSteel-Browserçš„æ’ä»¶æ¶æ„ï¼š

```typescript
import { BasePlugin } from "./plugins/core/base-plugin.js";
import { Browser, Page } from "puppeteer-core";

// è‡ªå®šä¹‰æ’ä»¶ç¤ºä¾‹
class CustomPlugin extends BasePlugin {
  constructor() {
    super("CustomPlugin");
  }

  async onBrowserLaunch(browser: Browser): Promise<void> {
    console.log("ğŸš€ æµè§ˆå™¨å¯åŠ¨æ’ä»¶å·²æ‰§è¡Œ");
  }

  async onPageCreated(page: Page): Promise<void> {
    console.log("ğŸ“„ é¡µé¢åˆ›å»ºæ’ä»¶å·²æ‰§è¡Œ");
    
    // æ³¨å…¥è‡ªå®šä¹‰è„šæœ¬
    await page.evaluateOnNewDocument(() => {
      // éšè—webdriverå±æ€§
      Object.defineProperty(navigator, 'webdriver', {
        get: () => undefined,
      });
      
      // ä¿®æ”¹plugins
      Object.defineProperty(navigator, 'plugins', {
        get: () => [1, 2, 3, 4, 5],
      });
    });
  }

  async onPageLoaded(page: Page): Promise<void> {
    console.log("ğŸ“– é¡µé¢åŠ è½½æ’ä»¶å·²æ‰§è¡Œ");
  }
}

// ä½¿ç”¨æ’ä»¶
async function pluginExample() {
  const browser = await puppeteer.launch({
    headless: false
  });
  
  const plugin = new CustomPlugin();
  
  try {
    const page = await browser.newPage();
    
    // æ‰§è¡Œæ’ä»¶
    await plugin.onBrowserLaunch(browser);
    await plugin.onPageCreated(page);
    
    await page.goto('https://example.com');
    
    await plugin.onPageLoaded(page);
    
  } finally {
    await browser.close();
  }
}
```

### 3. ç½‘ç»œæ‹¦æˆªå’Œä¿®æ”¹

```typescript
async function networkInterceptionExample() {
  const browser = await puppeteer.launch({
    headless: false
  });
  
  try {
    const page = await browser.newPage();
    
    // å¯ç”¨è¯·æ±‚æ‹¦æˆª
    await page.setRequestInterception(true);
    
    // æ‹¦æˆªè¯·æ±‚
    page.on('request', (request) => {
      const url = request.url();
      
      // é˜»æ­¢å¹¿å‘Šè¯·æ±‚
      if (url.includes('ads') || url.includes('analytics')) {
        request.abort();
        console.log(`ğŸš« é˜»æ­¢è¯·æ±‚: ${url}`);
        return;
      }
      
      // ä¿®æ”¹è¯·æ±‚å¤´
      const headers = {
        ...request.headers(),
        'X-Custom-Header': 'CustomValue',
        'User-Agent': 'Custom User Agent'
      };
      
      request.continue({ headers });
    });
    
    // æ‹¦æˆªå“åº”
    page.on('response', (response) => {
      const url = response.url();
      const status = response.status();
      
      console.log(`ğŸ“¡ å“åº”: ${status} - ${url}`);
      
      // ä¿®æ”¹å“åº”å†…å®¹
      if (url.includes('example.com') && status === 200) {
        response.text().then(text => {
          console.log('ğŸ“„ å“åº”å†…å®¹:', text.substring(0, 100));
        });
      }
    });
    
    await page.goto('https://example.com');
    
  } finally {
    await browser.close();
  }
}
```

## æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

```typescript
import { RetryManager, RetryOptions } from "./utils/retry.js";

class BrowserAutomation {
  private retryManager: RetryManager;
  
  constructor() {
    this.retryManager = new RetryManager();
  }
  
  async performActionWithRetry<T>(
    action: () => Promise<T>,
    options: RetryOptions = {}
  ): Promise<T> {
    const defaultOptions: RetryOptions = {
      maxRetries: 3,
      delay: 1000,
      backoff: 2,
      ...options
    };
    
    return this.retryManager.retry(action, defaultOptions);
  }
  
  async navigateWithRetry(page: Page, url: string): Promise<void> {
    return this.performActionWithRetry(async () => {
      const response = await page.goto(url, {
        waitUntil: 'networkidle2',
        timeout: 30000
      });
      
      if (!response?.ok()) {
        throw new Error(`å¯¼èˆªå¤±è´¥: ${response?.status()} ${response?.statusText()}`);
      }
    });
  }
  
  async clickWithRetry(page: Page, selector: string): Promise<void> {
    return this.performActionWithRetry(async () => {
      await page.waitForSelector(selector, { timeout: 10000 });
      await page.click(selector);
    });
  }
}
```

### 2. æ€§èƒ½ä¼˜åŒ–

```typescript
async function optimizedBrowserExample() {
  const browser = await puppeteer.launch({
    headless: false,
    args: [
      '--no-sandbox',
      '--disable-dev-shm-usage',
      '--disable-gpu',
      '--disable-background-timer-throttling',
      '--disable-backgrounding-occluded-windows',
      '--disable-renderer-backgrounding',
      '--disable-features=TranslateUI',
      '--disable-ipc-flooding-protection',
      '--memory-pressure-off',
      '--max_old_space_size=4096'
    ]
  });
  
  try {
    const page = await browser.newPage();
    
    // ä¼˜åŒ–é¡µé¢æ€§èƒ½
    await page.setCacheEnabled(true);
    
    // è®¾ç½®èµ„æºæ‹¦æˆª
    await page.setRequestInterception(true);
    page.on('request', (request) => {
      const resourceType = request.resourceType();
      
      // é˜»æ­¢ä¸å¿…è¦çš„èµ„æº
      if (['image', 'stylesheet', 'font'].includes(resourceType)) {
        request.abort();
      } else {
        request.continue();
      }
    });
    
    // è®¾ç½®è§†å£
    await page.setViewport({
      width: 1280,
      height: 720,
      deviceScaleFactor: 1
    });
    
    await page.goto('https://example.com');
    
  } finally {
    await browser.close();
  }
}
```

### 3. èµ„æºç®¡ç†

```typescript
class BrowserManager {
  private browsers: Map<string, Browser> = new Map();
  private maxBrowsers: number = 5;
  
  async getBrowser(sessionId: string): Promise<Browser> {
    if (this.browsers.has(sessionId)) {
      return this.browsers.get(sessionId)!;
    }
    
    if (this.browsers.size >= this.maxBrowsers) {
      // å…³é—­æœ€æ—§çš„æµè§ˆå™¨
      const oldestSessionId = this.browsers.keys().next().value;
      await this.closeBrowser(oldestSessionId);
    }
    
    const browser = await puppeteer.launch({
      headless: false,
      args: ['--no-sandbox', '--disable-dev-shm-usage']
    });
    
    this.browsers.set(sessionId, browser);
    return browser;
  }
  
  async closeBrowser(sessionId: string): Promise<void> {
    const browser = this.browsers.get(sessionId);
    if (browser) {
      await browser.close();
      this.browsers.delete(sessionId);
    }
  }
  
  async closeAllBrowsers(): Promise<void> {
    const closePromises = Array.from(this.browsers.values()).map(browser => 
      browser.close()
    );
    await Promise.all(closePromises);
    this.browsers.clear();
  }
}
```

## æ•…éšœæ’é™¤

### 1. å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

```typescript
// 1. æµè§ˆå™¨å¯åŠ¨å¤±è´¥
async function handleBrowserLaunchError() {
  try {
    const browser = await puppeteer.launch({
      headless: false,
      args: ['--no-sandbox', '--disable-dev-shm-usage']
    });
  } catch (error) {
    console.error('æµè§ˆå™¨å¯åŠ¨å¤±è´¥:', error);
    
    // è§£å†³æ–¹æ¡ˆ1: æ£€æŸ¥Chromeè·¯å¾„
    const chromePath = '/Applications/Google Chrome.app/Contents/MacOS/Google Chrome';
    const browser = await puppeteer.launch({
      executablePath: chromePath,
      headless: false
    });
    
    // è§£å†³æ–¹æ¡ˆ2: ä½¿ç”¨ç³»ç»ŸChrome
    const browser = await puppeteer.launch({
      product: 'chrome',
      headless: false
    });
  }
}

// 2. é¡µé¢å¯¼èˆªè¶…æ—¶
async function handleNavigationTimeout(page: Page) {
  try {
    await page.goto('https://example.com', {
      waitUntil: 'networkidle2',
      timeout: 30000
    });
  } catch (error) {
    console.error('é¡µé¢å¯¼èˆªè¶…æ—¶:', error);
    
    // è§£å†³æ–¹æ¡ˆ: å¢åŠ è¶…æ—¶æ—¶é—´æˆ–ä½¿ç”¨ä¸åŒçš„ç­‰å¾…ç­–ç•¥
    await page.goto('https://example.com', {
      waitUntil: 'domcontentloaded',
      timeout: 60000
    });
  }
}

// 3. å…ƒç´ é€‰æ‹©å™¨æ‰¾ä¸åˆ°
async function handleSelectorNotFound(page: Page) {
  try {
    await page.click('#non-existent-element');
  } catch (error) {
    console.error('å…ƒç´ æœªæ‰¾åˆ°:', error);
    
    // è§£å†³æ–¹æ¡ˆ: ç­‰å¾…å…ƒç´ å‡ºç°
    await page.waitForSelector('#non-existent-element', {
      timeout: 10000,
      visible: true
    });
    
    // æˆ–è€…ä½¿ç”¨æ›´çµæ´»çš„é€‰æ‹©å™¨
    await page.waitForFunction(() => {
      return document.querySelector('#non-existent-element') !== null;
    }, { timeout: 10000 });
  }
}
```

### 2. è°ƒè¯•æŠ€å·§

```typescript
async function debugBrowserExample() {
  const browser = await puppeteer.launch({
    headless: false,
    devtools: true, // æ‰“å¼€å¼€å‘è€…å·¥å…·
    args: ['--no-sandbox', '--disable-dev-shm-usage']
  });
  
  try {
    const page = await browser.newPage();
    
    // ç›‘å¬æ§åˆ¶å°æ—¥å¿—
    page.on('console', msg => {
      console.log('æµè§ˆå™¨æ§åˆ¶å°:', msg.text());
    });
    
    // ç›‘å¬é¡µé¢é”™è¯¯
    page.on('pageerror', error => {
      console.error('é¡µé¢é”™è¯¯:', error.message);
    });
    
    // ç›‘å¬è¯·æ±‚å¤±è´¥
    page.on('requestfailed', request => {
      console.error('è¯·æ±‚å¤±è´¥:', request.url());
    });
    
    // è®¾ç½®æ…¢åŠ¨ä½œæ¨¡å¼ï¼ˆè°ƒè¯•ç”¨ï¼‰
    await page.setDefaultNavigationTimeout(0);
    await page.setDefaultTimeout(0);
    
    // æ·»åŠ è°ƒè¯•è„šæœ¬
    await page.evaluateOnNewDocument(() => {
      // åœ¨é¡µé¢ä¸­æ³¨å…¥è°ƒè¯•ä¿¡æ¯
      window.debugInfo = {
        userAgent: navigator.userAgent,
        viewport: {
          width: window.innerWidth,
          height: window.innerHeight
        },
        timestamp: Date.now()
      };
      
      console.log('è°ƒè¯•ä¿¡æ¯:', window.debugInfo);
    });
    
    await page.goto('https://example.com');
    
    // æš‚åœæ‰§è¡Œï¼ˆè°ƒè¯•ç”¨ï¼‰
    await page.evaluate(() => {
      debugger;
    });
    
  } finally {
    await browser.close();
  }
}
```

### 3. æ€§èƒ½ç›‘æ§

```typescript
async function monitorPerformance(page: Page) {
  // å¯ç”¨æ€§èƒ½ç›‘æ§
  const client = await page.target().createCDPSession();
  await client.send('Performance.enable');
  
  // ç›‘å¬æ€§èƒ½æŒ‡æ ‡
  client.on('Performance.metrics', data => {
    const metrics = data.metrics;
    console.log('æ€§èƒ½æŒ‡æ ‡:', {
      Documents: metrics.find(m => m.name === 'Documents')?.value,
      Frames: metrics.find(m => m.name === 'Frames')?.value,
      JSEventListeners: metrics.find(m => m.name === 'JSEventListeners')?.value,
      Nodes: metrics.find(m => m.name === 'Nodes')?.value,
      LayoutCount: metrics.find(m => m.name === 'LayoutCount')?.value,
      RecalcStyleCount: metrics.find(m => m.name === 'RecalcStyleCount')?.value,
      LayoutDuration: metrics.find(m => m.name === 'LayoutDuration')?.value,
      RecalcStyleDuration: metrics.find(m => m.name === 'RecalcStyleDuration')?.value,
      ScriptDuration: metrics.find(m => m.name === 'ScriptDuration')?.value,
      TaskDuration: metrics.find(m => m.name === 'TaskDuration')?.value,
      JSHeapUsedSize: metrics.find(m => m.name === 'JSHeapUsedSize')?.value,
      JSHeapTotalSize: metrics.find(m => m.name === 'JSHeapTotalSize')?.value,
    });
  });
  
  // è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ
  const memoryInfo = await page.evaluate(() => {
    if ('memory' in performance) {
      return (performance as any).memory;
    }
    return null;
  });
  
  console.log('å†…å­˜ä½¿ç”¨æƒ…å†µ:', memoryInfo);
}
```

## æ€»ç»“

æœ¬æ•™ç¨‹åŸºäºSteel-Browseré¡¹ç›®çš„å®é™…ä»£ç ï¼Œè¯¦ç»†ä»‹ç»äº†Puppeteerçš„ä½¿ç”¨æ–¹æ³•ã€‚é€šè¿‡å­¦ä¹ æœ¬æ•™ç¨‹ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š

1. **ç¯å¢ƒæ­å»º**: æ­£ç¡®å®‰è£…å’Œé…ç½®Puppeteerå¼€å‘ç¯å¢ƒ
2. **åŸºç¡€æ“ä½œ**: æŒæ¡æµè§ˆå™¨å¯åŠ¨ã€é¡µé¢å¯¼èˆªã€å…ƒç´ æ“ä½œç­‰åŸºç¡€åŠŸèƒ½
3. **é«˜çº§ç‰¹æ€§**: äº†è§£æŒ‡çº¹æ³¨å…¥ã€æ’ä»¶ç³»ç»Ÿã€ç½‘ç»œæ‹¦æˆªç­‰é«˜çº§åŠŸèƒ½
4. **æœ€ä½³å®è·µ**: å­¦ä¼šé”™è¯¯å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–ã€èµ„æºç®¡ç†ç­‰æœ€ä½³å®è·µ
5. **æ•…éšœæ’é™¤**: æŒæ¡å¸¸è§é—®é¢˜çš„è¯Šæ–­å’Œè§£å†³æ–¹æ³•

Puppeteeræ˜¯ä¸€ä¸ªå¼ºå¤§çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·ï¼Œç»“åˆSteel-Browseré¡¹ç›®çš„æ¶æ„ï¼Œå¯ä»¥æ„å»ºå‡ºåŠŸèƒ½ä¸°å¯Œã€æ€§èƒ½ä¼˜å¼‚çš„Webè‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆã€‚

