### 面试话术｜文件系统与预览

- 一句话简介：对任务产物做统一入库、可预览/可下载/可回溯的管理，支撑多格式结果在前端即刻呈现。

#### 我负责（15s）
- 统一文件 API 与权限边界；前端文件渲染链路

#### 实现要点（1min）
- Python API：`/v1/file_tool/*`（上传/下载/预览/列表）在 `genie-tool/api/file_manage.py`
- 数据层：`genie-tool/db/file_table.py` 与 `file_table_op.py` 管理元数据
- 前端：`ActionPanel` 下的 `FileRenderer/HTMLRenderer/MarkdownRenderer`
- 约定：按 `requestId` 目录隔离，`isInternalFile` 标识中间文件

#### 问题与解决
- 问题1：大文件内存占用高
  - 方案：流式上传与分块写入；下载采用分块响应
- 问题2：预览类型判定错误
  - 方案：后端基于魔数/MIME 严格识别；前端兜底下载
- 问题3：文件名注入与路径穿越
  - 方案：允许集合内字符集；归一化校验；拒绝相对穿越
- 问题4：中间产物污染最终结果
  - 方案：后端在 `ReactHandlerImpl` 过滤内部文件；前端隐藏中间文件

#### 指标
- 大文件（>50MB）上传成功率与耗时稳定；预览 404 几乎为 0

#### Q&A
- Q：如何保证“可追溯”？
  - A：所有文件带 `requestId`、`created_at`、`description` 等元数据；UI 可按任务聚合查看。

#### 演进
- 上云（S3/OSS）与签名 URL；生命周期管理（自动清理）
