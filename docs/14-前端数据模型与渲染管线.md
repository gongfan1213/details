### 前端数据模型与渲染管线

#### SSE 管道与请求参数
入口在 `ChatView`：生成 `sessionId/requestId/query/deepThink/outputStyle`，通过 `querySSE` 建立 SSE。
```56:72:ui/src/components/ChatView/index.tsx
const params = { sessionId, requestId, query: message, deepThink: deepThink ? 1 : 0, outputStyle };
querySSE({ body: params, handleMessage, handleError, handleClose });
```
封装：
```25:54:ui/src/utils/querySSE.ts
fetchEventSource(url, { method: 'POST', headers: SSE_HEADERS, body: JSON.stringify(body), onmessage, onerror, onclose });
```

#### 事件归并与状态机
核心逻辑在 `utils/chat.ts`：
- `combineData(eventData, currentChat)`：根据 `messageType` 分发到不同处理器
- `handleTaskData(currentChat, deepThink, multiAgent)`：提取计划、任务与工具结果，产出用于 UI 的 `taskList/plan/thought`
```1:22:ui/src/utils/chat.ts
export const combineData = (eventData, currentChat) => { switch (eventData.messageType) { case 'plan': ... case 'task': ... } };
```
内容消息的增量合并：
```205:247:ui/src/utils/chat.ts
// 进行中：codeOutput 追加；完成：填充 isFinal 与最终内容
```

#### 视图层
- 聊天区：`Dialogue` 渲染思考/响应片段
- 任务面板：`ActionView` 按任务维度分组展示工具执行过程与结果文件
- 文件预览：`FilePreview`/`HTMLRenderer`/`MarkdownRenderer`/`TableRenderer`

#### 交互细节
- `openAction`：当存在非纯文本类结果（如文件、搜索）时自动展开侧栏
- `scrollToTop`：每次新消息滚动定位
- 试用限制：收到 `status === 'tokenUseUp'` 弹窗提示

#### 易错点
- SSE 消息解析异常：单条 `event.data` JSON 解析失败需捕获，避免断流
- 心跳包：`packageType === 'heartbeat'` 需直接忽略，不参与渲染
- 大输出串联：对 `codeOutput`/HTML 长文的增量拼接要注意性能与去抖


